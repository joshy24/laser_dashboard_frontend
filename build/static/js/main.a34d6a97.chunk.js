(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{105:function(e,t,n){e.exports=n.p+"static/media/emergency_with_circle.0153b7ea.gif"},106:function(e,t,n){e.exports=n.p+"static/media/call_with_circle.34c87478.gif"},107:function(e,t,n){e.exports=n.p+"static/media/emergency.445ccffb.gif"},108:function(e,t,n){e.exports=n.p+"static/media/call.37865c67.gif"},109:function(e,t,n){e.exports=n.p+"static/media/police_car_right.ac863eef.png"},110:function(e,t,n){e.exports=n.p+"static/media/fire_truck_right.6e37ce5f.png"},111:function(e,t,n){e.exports=n.p+"static/media/ambulance_right.b91382e8.png"},112:function(e,t,n){e.exports=n.p+"static/media/police_car_left.8d1f2526.png"},113:function(e,t,n){e.exports=n.p+"static/media/fire_truck_left.9d5483a7.png"},114:function(e,t,n){e.exports=n.p+"static/media/ambulance_left.87cffdc0.png"},115:function(e,t,n){e.exports=n.p+"static/media/police_car_right_enroute.5563c3ab.png"},116:function(e,t,n){e.exports=n.p+"static/media/fire_truck_right_enroute.7fd11c10.png"},117:function(e,t,n){e.exports=n.p+"static/media/ambulance_right_enroute.03ea87aa.png"},118:function(e,t,n){e.exports=n.p+"static/media/police_car_left_enroute.7a96989b.png"},119:function(e,t,n){e.exports=n.p+"static/media/fire_truck_left_enroute.de7da3a0.png"},120:function(e,t,n){e.exports=n.p+"static/media/ambulance_left_enroute.90098924.png"},121:function(e,t,n){e.exports=n.p+"static/media/alert.77e4ae16.mp3"},131:function(e,t,n){e.exports=n(294)},137:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},138:function(e,t,n){e.exports=n.p+"static/media/car_test.4b63a07a.png"},179:function(e,t){},263:function(e,t,n){},282:function(e,t){},294:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(19),i=n.n(r),o=n(4),l=n(6),c=n(11),u=n(10),d=n(1),g=n(12),m=n(45),h=n(18),_=n(3),p=n.n(_),b=n(8),f=(n(137),n(105)),E=n.n(f),v=n(106),y=n.n(v),k=n(107),w=n.n(k),C=n(108),A=n.n(C),x=(n(138),n(109)),O=n.n(x),S=n(110),L=n.n(S),j=n(111),N=n.n(j),D=n(112),R=n.n(D),F=n(113),M=n.n(F),T=n(114),P=n.n(T),I=n(115),B=n.n(I),z=n(116),H=n.n(z),Y=n(117),q=n.n(Y),U=n(118),J=n.n(U),W=n(119),K=n.n(W),G=n(120),V=n.n(G),Z=n(121),$=n.n(Z),Q=n(27),X=n(122),ee=n.n(X),te=n(60),ne=n.n(te),ae=function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,[{key:"getDate",value:function(e){return ne()(e).utc().format("YYYY-MM-DD")}},{key:"getTime",value:function(e){return ne()(e).utc().format("HH:mm:ss")}},{key:"sortDates",value:function(e){return e.sort(function(e,t){return new Date(e.created)-new Date(t.created)}),e}}]),e}(),se=new ae;function re(e){return s.a.createElement("div",{className:"laser-side-bar"},s.a.createElement("h1",{className:"close_btn",onClick:function(t){return e.closeSidebar(t)}},"\u2715"),s.a.createElement("br",null),s.a.createElement("h4",{className:"text-center laser-red-text"},s.a.createElement("b",null,"Emergency Location Details")),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-red-bg laserbtn",onClick:function(t){return e.startMonitoring(t,e.emergency)}},"Start Monitoring"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-blue-bg laserbtn",onClick:function(t){return e.resolve(t)}},"Resolve"),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Trackable")," - ",e.emergency.is_trackable?"Yes":"No"),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Time")," - ",se.getTime(e.emergency.created)),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Persons Name")," - ",e.emergency.full_name),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Person's Emergency Contacts")," - ",e.emergency.emergency_numbers&&e.emergency.emergency_numbers.length>0?e.emergency.emergency_numbers.map(function(e,t){return s.a.createElement("p",{key:t},e)}):""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Email Address")," - ",e.emergency.email?e.emergency.email:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Phone Number")," - ",e.emergency.phone_number?e.emergency.phone_number:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Device")," - ",e.emergency.device?e.emergency.device:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Emergency Full Address")," - ",e.emergency.full_address?e.emergency.full_address:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Emergency Admin Address")," - ",e.emergency.sub_admin_address?e.emergency.sub_admin_address:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Reason For Emergency")," - ",e.emergency.reasons?function(e){switch(e.length){case 0:return"";case 1:return e[0]+" emergency";case 2:return e[0]+" emergency, "+e[1]+" emergency";case 3:return e[0]+" emergency, "+e[1]+" emergency, "+e[2]+" emergency"}}(e.emergency.reasons):""))}var ie={width:"100%"};function oe(e){return s.a.createElement("div",{className:"laser-action_div laser-shadow"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h1",{style:ie},s.a.createElement("span",{onClick:function(t){return e.closeAction(t)},className:"action_close_btn"},"\u2715"))),s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h5",null,e.text))))}function le(e){return s.a.createElement("div",null,function(e,t,n){switch(e){case"loading":return s.a.createElement(oe,{text:"Loading...",closeAction:n});case"close":return"";case"err_calls_load":return s.a.createElement(oe,{text:"An Error occurred loading latest calls",closeAction:n});case"err_emergency_load":return s.a.createElement(oe,{text:"An Error occurred loading latest emergencies",closeAction:n});case"message":return s.a.createElement(oe,{text:t,closeAction:n})}}(e.action,e.message,e.closeAction))}var ce={background:"#2E86C1",border:"0px solid #000000",color:"#FFFFFF",padding:"8px",borderRadius:"4px"},ue={background:"#000000",border:"0px solid #000000",color:"#FFFFFF",padding:"8px",borderRadius:"4px"};function de(e){return s.a.createElement("div",{className:"laser-agent_side-bar"},s.a.createElement("h1",{className:"close_btn",onClick:function(t){return e.closeAgentSideBar(t)}},"\u2715"),s.a.createElement("br",null),s.a.createElement("h4",{className:"text-center laser-black-text"},s.a.createElement("b",null,"Agents Details")),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Agents Name")," - ",e.agent.agent.firstname," ",e.agent.agent.lastname),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Phone Number")," - ",e.agent.agent.phone_number),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Agency")," - ",e.agent.agent.department),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Current Location")," - ",e.agent.full_address),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Availability")," - ",e.agent.is_on_route?e.agent.agent.firstname+" is currently on route to a person's locations":e.agent.agent.firstname+" is available"),s.a.createElement("p",null,e.agent.is_on_route?s.a.createElement("button",{style:ue,onClick:function(t){return e.removeAgentFromRoute(t,e.agent)},className:""},"Remove agent from route"):""),s.a.createElement("br",null),e.user.full_name?s.a.createElement("button",{style:ce,onClick:function(t){return e.addAgentToMonitoring(t,e.agent)},className:""},"Send Agent ",e.agent.agent.firstname," ",e.agent.agent.lastname," to ",e.user.full_name,"'s location "):"")}var ge=new ae;function me(e){return s.a.createElement("div",{className:"laser-side-bar"},s.a.createElement("h1",{className:"close_btn",onClick:function(t){return e.closeSidebar(t)}},"\u2715"),s.a.createElement("br",null),s.a.createElement("h4",{className:"text-center laser-blue-text"},s.a.createElement("b",null,"Call Location Details")),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Time")," - ",ge.getTime(e.location.created)),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Persons Name")," - ",e.location.full_name),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Email Address")," - ",e.location.email?e.location.email:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Phone Number")," - ",e.location.phone_number?e.location.phone_number:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Call Full Address")," - ",e.location.full_address?e.location.full_address:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Call Admin Address")," - ",e.location.sub_admin_address?e.location.sub_admin_address:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Reason For Call")," - ",e.location.reason?e.location.reason:""))}var he=n(123),_e=n.n(he),pe={color:"#111111",border:"1px solid #FFFFFF",zIndex:"6000",marginLeft:"8px",marginRight:"8px",padding:"8px"},be={marginLeft:"8px",marginRight:"8px"},fe=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"laser-top-panel"},s.a.createElement("h4",{className:"laser-inline"},"Laser Emergency Admin Platform"),s.a.createElement("div",{className:"laser-controls"},s.a.createElement("button",{onClick:function(t){return e.props.getAllAgentsLocation(t)},className:"form-control laser-inline laser-150-width laser-red-bg laserbtn"},"Locate All Agents"),s.a.createElement("div",{className:"laser-inline",style:pe},s.a.createElement(_e.a,{onCalendarOpen:this.props.onCalendarOpen,maxDate:new Date,style:pe,onChange:this.props.onDateChange,value:this.props.date})),s.a.createElement("select",{style:be,className:"form-control laser-inline laser-150-width",id:"calls",name:"calls",value:this.props.selected_call,onChange:this.props.onCallsChanged},s.a.createElement("option",null,"Calls (All)"),s.a.createElement("option",null,"Emergency Management(LASEMA)"),s.a.createElement("option",null,"Police"),s.a.createElement("option",null,"Distress"),s.a.createElement("option",null,"Environmental and Special Offences Task Force"),s.a.createElement("option",null,"Fire / Safety Services"),s.a.createElement("option",null,"Environmental / Noise Pollution"),s.a.createElement("option",null,"Broken Pipe / Water Leakage"),s.a.createElement("option",null,"Pothole / Collapsed Road"),s.a.createElement("option",null,"None")),s.a.createElement("select",{style:be,className:"form-control laser-inline laser-150-width",id:"emergencies",name:"emergencies",value:this.props.selected_emergency,onChange:this.props.onEmergenciesChanged},s.a.createElement("option",null,"Emergencies (All)"),s.a.createElement("option",null,"Police Cases"),s.a.createElement("option",null,"Hospital Cases"),s.a.createElement("option",null,"Fire Cases"),s.a.createElement("option",null,"None")),s.a.createElement("button",{onClick:function(t){return e.props.logout(t)},className:"form-control laser-inline laser-100-width laser-grey-bg laserbtn"},"logout")))}}]),t}(a.Component),Ee=new ae,ve={background:"rgba(0,0,0,0)",border:"0px solid #000000"};function ye(e){return s.a.createElement("button",{className:"laserItem",style:ve,onClick:function(t){return e.itemClicked(t,e.item)}},s.a.createElement("h5",{style:ke(e.item.laser_type)},e.item.full_name," - ",Ee.getTime(e.item.created)," - ",e.item.sub_admin_address))}function ke(e){switch(e){case"emergency":return{color:"#E74C3C",textAlign:"left"};case"call":return{color:"#3498DB",textAlign:"left"};default:return{color:"#000000",textAlign:"left"}}}var we=n(124),Ce=n.n(we),Ae={width:"380px",height:"400px"},xe=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={},n.itemClicked=n.itemClicked.bind(Object(d.a)(n)),n}return Object(g.a)(t,e),Object(l.a)(t,[{key:"itemClicked",value:function(e,t){e.preventDefault(),this.props.latestClicked(t)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"laser-latest-div laser-shadow"},s.a.createElement("h4",{className:"text-center laser-black-text"},"Latest Reports"),s.a.createElement(Ce.a,{style:Ae},this.props.latest.map(function(t){return s.a.createElement(ye,{key:t._id,itemClicked:e.itemClicked,item:t})})))}}]),t}(a.Component),Oe=n(17),Se=n.n(Oe),Le={margin:"16px"},je={background:"#2E86C1",border:"0px solid #000000",color:"#FFFFFF",padding:"8px",borderRadius:"4px",float:"left",marginLeft:"20px"};function Ne(e){return s.a.createElement("div",null,s.a.createElement(Se.a,{isOpen:!0,className:"Modal",overlayClassName:"Overlay",contentLabel:"Minimal Modal Example"},s.a.createElement("h4",{className:"text-center"},"Message From Agent"),s.a.createElement("button",{className:"grey-bg bt-btn pull-right",style:Le,onClick:e.closeRouteResponse},"close"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-8 col-sm-8"},s.a.createElement("h5",{className:"black-text"},e.route_response.agent.agent.firstname," ",e.route_response.agent.agent.lastname," has completed the route to ",e.route_response.user.full_name,"'s location")),s.a.createElement("div",{className:"col-md-4 col-sm-4"},s.a.createElement("h5",null,s.a.createElement("b",null,"Phone Number")),s.a.createElement("h5",null,e.route_response.agent.agent.phone_number))),s.a.createElement("div",{className:"row"},s.a.createElement("h5",null,s.a.createElement("button",{className:"green-bg bt-btn",style:je,onClick:function(t){return e.removeAgentFromRouteAndCloseRouteResponse(t,e.route_response.agent,e.route_response)}},"Remove Agent From Route")))))}Se.a.setAppElement("#main"),Se.a.setAppElement("#main");var De={marginLeft:"16px",marginRight:"8px"},Re={marginLeft:"8px",marginRight:"16px"};function Fe(e){return s.a.createElement("div",null,s.a.createElement(Se.a,{isOpen:!0,className:"ConfirmModal",overlayClassName:"Overlay",contentLabel:"Minimal Modal Example"},s.a.createElement("h4",{className:"text-center blue-text"},"Confirmation"),s.a.createElement("br",null),s.a.createElement("h5",{className:"text-center"},e.message),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-inline laser-blue-bg laserbtn",style:De,onClick:e.yesClicked},"yes"),s.a.createElement("button",{className:"laser-inline grey-bg laserbtn",style:Re,onClick:e.noClicked},"no")))}var Me=function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,[{key:"saveSelectedAgents",value:function(e){localStorage.setItem("selected_agents",JSON.stringify(e))}},{key:"getSelectedAgents",value:function(){return JSON.parse(localStorage.getItem("selected_agents"))}}]),e}(),Te=n(61),Pe=n.n(Te),Ie=n(125),Be=n.n(Ie),ze=(n(263),n(126)),He=n.n(ze),Ye=n(62),qe=n.n(Ye),Ue=function e(){var t=this;Object(o.a)(this,e),this.login=function(e,n){return t.axios("/login",{username:e,password:n}).then(function(e){return t.setToken(e.data.token),e}).catch(function(e){return"error"})},this.loggedIn=function(){var e=t.getToken();return!!e&&!t.isTokenExpired(e)},this.isTokenExpired=function(e){try{return qe()(e).exp<Date.now()/1e3}catch(t){return console.log("expired check failed! Line 42: AuthService.js"),!1}},this.setToken=function(e){localStorage.setItem("id_token",e)},this.getToken=function(){return localStorage.getItem("id_token")},this.logout=function(){localStorage.removeItem("id_token")},this.getConfirm=function(){var e=qe()(t.getToken());return console.log("Recieved answer!"),e},this.axios=function(e,n){var a={Accept:"application/json","Content-Type":"application/json"};return t.loggedIn()&&(a.Authorization="Bearer:"+t.getToken()),He()({url:e,method:"post",data:n,baseURL:"http://52.59.255.174/admin",timeout:3e4,headers:a}).then(t._checkStatus).then(function(e){return e}).catch(function(e){return e})},this._checkStatus=function(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}},Je=(new Ue).axios,We=function(e){return Je("/getLocations",e).then(function(e){return e}).catch(function(e){return console.log({err:e}),"error"})},Ke=function(e){return Je("/getEmergencies",e).then(function(e){return e}).catch(function(e){return console.log({err:e}),"error"})},Ge=new ae,Ve=new Me,Ze={height:"100vh",width:"100%"},$e=(new Date).toISOString(),Qe=null,Xe=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={showConfirm:{action:"",status:!1},latest:[],locations:[],emergencies:[],filtered_locations:[],filtered_emergencies:[],side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!1,clicked_user:{},clicked_agent:{},center:{lat:6.5244,lng:3.3792},selected_call:"Calls (All)",selected_emergency:"Emergencies (All)",zoom:11,show_red_circle:!1,show_blue_circle:!1,clicked_marker_id:"",play_sound:!1,channels_list:["lllaser"],laser_agents:[],selected_agents:[],route_responses_from_agents:[],tracked_user_id:"",action:"loading",action_message:"",tracked_area:"lllaser",date:new Date,message:""},n.pubnub=new Be.a({publishKey:"pub-c-100b3918-0e25-4fac-ade6-c58d013cd019",subscribeKey:"sub-c-21e1e450-9457-11e9-bf84-1623aee89087"}),n.pubnub.init(Object(d.a)(n)),n.closeSideBar=n.closeSideBar.bind(Object(d.a)(n)),n.onCallsChanged=n.onCallsChanged.bind(Object(d.a)(n)),n.onEmergenciesChanged=n.onEmergenciesChanged.bind(Object(d.a)(n)),n.onAgentClicked=n.onAgentClicked.bind(Object(d.a)(n)),n.onDateChange=n.onDateChange.bind(Object(d.a)(n)),n.onCalendarOpen=n.onCalendarOpen.bind(Object(d.a)(n)),n.latestClicked=n.latestClicked.bind(Object(d.a)(n)),n.startMonitoring=n.startMonitoring.bind(Object(d.a)(n)),n.closeAction=n.closeAction.bind(Object(d.a)(n)),n.closeAgentSideBar=n.closeAgentSideBar.bind(Object(d.a)(n)),n.addAgentToMonitoring=n.addAgentToMonitoring.bind(Object(d.a)(n)),n.getAgentIcon=n.getAgentIcon.bind(Object(d.a)(n)),n.getAllAgentsLocation=n.getAllAgentsLocation.bind(Object(d.a)(n)),n.handleSongFinishedPlaying=n.handleSongFinishedPlaying.bind(Object(d.a)(n)),n.removeAgentFromRoute=n.removeAgentFromRoute.bind(Object(d.a)(n)),n.closeRouteResponse=n.closeRouteResponse.bind(Object(d.a)(n)),n.removeAgentFromRouteAndCloseRouteResponse=n.removeAgentFromRouteAndCloseRouteResponse.bind(Object(d.a)(n)),n.getEmergencies=n.getEmergencies.bind(Object(d.a)(n)),n.getLocations=n.getLocations.bind(Object(d.a)(n)),n.getLocationsDate=n.getLocationsDate.bind(Object(d.a)(n)),n.getEmergenciesDate=n.getEmergenciesDate.bind(Object(d.a)(n)),n.getLatestEmergencies=n.getLatestEmergencies.bind(Object(d.a)(n)),n.getLatestLocations=n.getLatestLocations.bind(Object(d.a)(n)),n.resolveCall=n.resolveCall.bind(Object(d.a)(n)),n.resolveEmergency=n.resolveEmergency.bind(Object(d.a)(n)),n.hideConfirm=n.hideConfirm.bind(Object(d.a)(n)),n.showConfirmResolveEmergency=n.showConfirmResolveEmergency.bind(Object(d.a)(n)),n.showConfirmResolveLocation=n.showConfirmResolveLocation.bind(Object(d.a)(n)),n.logout=n.logout.bind(Object(d.a)(n));var a=$e.split(/T(.+)/)[0];return a+="T00:00:00.000Z",Qe=new Date(a),n}return Object(g.a)(t,e),Object(l.a)(t,[{key:"logout",value:function(){this.props.logout()}},{key:"resolveEmergency",value:function(){var e=Object(b.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showConfirm:{action:"",status:!1},message:"",action:"loading",action_message:""}),e.next=3,n={id:this.state.clicked_user._id},Je("/resolveEmergency",n).then(function(e){return e}).catch(function(e){return console.log({err:e}),"error"});case 3:if("error"!=(t=e.sent)){e.next=7;break}return this.setState({action:"message",action_message:"Emergency could not be resolved. Try again later"}),e.abrupt("return");case 7:t&&(this.setState({action:"close",side_bar_open:!1}),this.getLocationsDate(this.state.date),this.getEmergenciesDate(this.state.date),this.setState({latest:[]}),this.getLatestLocations(),this.getLatestEmergencies());case 8:case"end":return e.stop()}var n},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"resolveCall",value:function(){var e=Object(b.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showConfirm:{action:"",status:!1},message:"",action:"loading",action_message:""}),e.next=3,n={id:this.state.clicked_user._id},Je("/resolveCall",n).then(function(e){return e}).catch(function(e){return console.log({err:e}),"error"});case 3:"error"==(t=e.sent)&&this.setState({action:"message",action_message:"Call could not be resolved. Try again later"}),t&&(this.setState({action:"close",location_side_bar_open:!1}),this.getLocationsDate(this.state.date),this.getEmergenciesDate(this.state.date),this.setState({latest:[]}),this.getLatestLocations(),this.getLatestEmergencies());case 6:case"end":return e.stop()}var n},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"hideConfirm",value:function(){this.setState({showConfirm:{action:"",status:!1},message:""})}},{key:"showConfirmResolveEmergency",value:function(e){e.preventDefault(),this.setState({showConfirm:{action:"emergency",status:!0},message:"Are you sure you want to mark this emergency issue as resolved ?"})}},{key:"showConfirmResolveLocation",value:function(){this.setState({showConfirm:{action:"location",status:!0},message:"Are you sure you want to mark this call as resolved ?"})}},{key:"removeAgentFromRoute",value:function(e,t){var n=this;e.preventDefault(),this.pubnub.publish({message:{pn_gcm:{data:{notification_body:"You need to abandon route. Tap to open app",data:{},action:"leave_route"}}},channel:t.agent._id,sendByPost:!1,storeInHistory:!1},function(e,t){}),this.setState(function(e){var a=e.selected_agents,s=e.channels_list,r=e.laser_agents,i=[];i.length>1&&(i=a.map(function(e){if(e.agent._id!==t.agent._id)return e}));var o=s.splice(s.indexOf(t.agent._id),1),l=r.find(function(e){return e.agent._id===t.agent._id}),c=Object.assign({},l);c.is_on_route=!1;r.splice(r.indexOf(l),1,c);return n.pubnub.unsubscribe({channels:[t.agent._id]}),Ve.saveSelectedAgents(i),{selected_agents:i,laser_agents:r,channels_list:o,agent_side_bar_open:!1,clicked_agent:{}}})}},{key:"removeAgentFromRouteAndCloseRouteResponse",value:function(e,t,n){var a=this;e.preventDefault(),this.pubnub.publish({message:{pn_gcm:{data:{notification_body:"You need to abandon route. Tap to open app",data:{},action:"leave_route"}}},channel:t.agent._id,sendByPost:!1,storeInHistory:!1},function(e,t){}),this.setState(function(e){var s=e.selected_agents,r=e.channels_list,i=e.route_responses_from_agents;i.splice(i.indexOf(n),1);var o=[];o.length>1&&(o=s.map(function(e){if(e.agent._id!==t.agent._id)return e}));var l=r.splice(r.indexOf(t.agent._id),1);return a.pubnub.unsubscribe({channels:[t.agent._id]}),Ve.saveSelectedAgents(o),{selected_agents:o,channels_list:l,route_responses_from_agents:i,agent_side_bar_open:!1,clicked_agent:{}}})}},{key:"addAgentToMonitoring",value:function(e,t){var n=this;e.preventDefault(),this.pubnub.publish({message:{pn_gcm:{data:{notification_body:"You have a new route. Tap to open app.",data:this.state.clicked_user.phone_number?{full_name:this.state.clicked_user.full_name,_id:this.state.clicked_user.user,phone_number:this.state.clicked_user.phone_number,latitude:this.state.clicked_user.latitude,longitude:this.state.clicked_user.longitude}:{full_name:this.state.clicked_user.full_name,_id:this.state.clicked_user.user,latitude:this.state.clicked_user.latitude,longitude:this.state.clicked_user.longitude},action:"route_request"}}},channel:t.agent._id,sendByPost:!1,storeInHistory:!1},function(e,t){}),this.setState(function(e){var a=e.selected_agents,s=e.channels_list,r=[];a.length>0?(r=a.map(function(e){return e.agent._id===t.agent._id?t:e})).find(function(e){return e.agent._id===t.agent._id})||r.push(t):r.push(t);return-1===s.indexOf(t.agent._id)&&s.push(t.agent._id),n.pubnub.subscribe({channels:s}),Ve.saveSelectedAgents(r),{selected_agents:r,channels_list:s}})}},{key:"startMonitoring",value:function(e,t){var n=this;e.preventDefault(),this.pubnub.publish({message:{pn_gcm:{data:{notification_body:"Tap to open the laser App",data:{},action:"send_location"}}},channel:this.state.tracked_area,sendByPost:!1,storeInHistory:!1},function(e,t){}),this.setState(function(e){var a=e.channels_list;return-1===a.indexOf(t.user)&&a.push(t.user),n.pubnub.subscribe({channels:a}),{action:"message",action_message:"You are now monitoring "+t.full_name,channels_list:a,laser_agents:[],tracked_user_id:t.user}})}},{key:"latestClicked",value:function(e){switch(e.laser_type){case"emergency":this.setState({clicked_user:e,side_bar_open:!0,location_side_bar_open:!1,agent_side_bar_open:!1,center:{lat:e.latitude,lng:e.longitude},zoom:19,show_red_circle:!0,show_blue_circle:!1,clicked_marker_id:e._id});break;case"call":this.setState({clicked_user:e,side_bar_open:!1,location_side_bar_open:!0,agent_side_bar_open:!1,center:{lat:e.latitude,lng:e.longitude},zoom:19,show_red_circle:!1,show_blue_circle:!0,clicked_marker_id:e._id})}}},{key:"onCalendarOpen",value:function(){this.setState({play_sound:!1,side_bar_open:!1,location_side_bar_open:!1,agent_side_bar_open:!1})}},{key:"onDateChange",value:function(e){(e=new Date(e)).setHours(e.getHours()+1),this.setState({play_sound:!1,date:e,show_red_circle:!1,show_blue_circle:!1,clicked_marker_id:"",action:"loading",action_message:"",selected_call:"Calls (All)",selected_emergency:"Emergencies (All)"}),this.getLocationsDate(e),this.getEmergenciesDate(e)}},{key:"onCallsChanged",value:function(e){var t=e.target,n=t.value,a=(t.name,[]);this.state.locations.length>0?"Calls (All)"===n?this.setState(function(e){return{play_sound:!1,filtered_locations:e.locations,side_bar_open:!1,selected_call:n,agent_side_bar_open:!1,location_side_bar_open:!1,show_blue_circle:!1}}):"None"===n?this.setState({play_sound:!1,filtered_locations:[],side_bar_open:!1,selected_call:n,agent_side_bar_open:!1,location_side_bar_open:!1,show_blue_circle:!1}):(this.state.locations.map(function(e){e.reason.includes(n.toLowerCase())&&a.push(e)}),a.length>0?this.setState({play_sound:!1,filtered_locations:a,selected_call:n,side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!1,show_blue_circle:!1}):this.setState({play_sound:!1,filtered_locations:[],selected_call:n,side_bar_open:!1,location_side_bar_open:!1,show_blue_circle:!1})):this.setState({selected_call:n})}},{key:"onEmergenciesChanged",value:function(e){var t=e.target,n=t.value,a=(t.name,[]);this.state.emergencies.length>0?"Emergencies (All)"===n?this.setState(function(e){return{play_sound:!1,filtered_emergencies:e.emergencies,side_bar_open:!1,selected_emergency:n,location_side_bar_open:!1,agent_side_bar_open:!1,show_red_circle:!1}}):"None"===n?this.setState({play_sound:!1,filtered_emergencies:[],selected_emergency:n,side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!1,show_red_circle:!1}):(this.state.emergencies.map(function(e){e.reasons&&e.reasons.length>0&&e.reasons.map(function(t){n.toLowerCase().includes(t)&&a.push(e)})}),a.length>0?this.setState({play_sound:!1,filtered_emergencies:a,selected_emergency:n,side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!1,show_red_circle:!1}):this.setState({play_sound:!1,filtered_emergencies:[],side_bar_open:!1,selected_emergency:n,agent_side_bar_open:!1,location_side_bar_open:!1,show_red_circle:!1})):this.setState({selected_emergency:n})}},{key:"onLocationClicked",value:function(e,t){this.setState({play_sound:!1,clicked_user:e,side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!0,center:{lat:e.latitude,lng:e.longitude},zoom:19,show_red_circle:!1,show_blue_circle:!0,clicked_marker_id:e._id})}},{key:"onEmergencyClicked",value:function(e,t){this.setState({play_sound:!1,clicked_user:e,clicked_agent:{},side_bar_open:!0,agent_side_bar_open:!1,location_side_bar_open:!1,center:{lat:e.latitude,lng:e.longitude},zoom:19,show_red_circle:!0,show_blue_circle:!1,clicked_marker_id:e._id})}},{key:"onAgentClicked",value:function(e,t){this.setState({play_sound:!1,clicked_agent:e,agent_side_bar_open:!0})}},{key:"getLocationsMarkers",value:function(){var e=this;return this.state.filtered_locations.length>0?this.state.filtered_locations.map(function(t){return s.a.createElement(Q.Marker,{key:t._id,onClick:function(n){return e.onLocationClicked(t,n)},name:t.reason,title:t.full_name,position:{lat:t.latitude,lng:t.longitude},icon:{url:e.state.clicked_marker_id===t._id?y.a:A.a}})}):""}},{key:"getEmergenciesMarkers",value:function(){var e=this;return this.state.filtered_emergencies.length>0?this.state.filtered_emergencies.map(function(t){return s.a.createElement(Q.Marker,{key:t._id,onClick:function(n){return e.onEmergencyClicked(t,n)},name:t.reasons[0],title:t.full_name,position:{lat:t.latitude,lng:t.longitude},icon:{url:e.state.clicked_marker_id===t._id?E.a:w.a}})}):""}},{key:"getAgentMarkers",value:function(){var e=this;return this.state.laser_agents.length>0?this.state.laser_agents.map(function(t,n){return s.a.createElement(Q.Marker,{key:n,onClick:function(n){return e.onAgentClicked(t,n)},name:t.full_address,title:t.full_address,position:{lat:t.latitude,lng:t.longitude},icon:{url:e.getAgentIcon(t)}})}):""}},{key:"getAgentIcon",value:function(e){switch(e.agent.department){case"police":return e.bearing>90||e.bearing<=270?e.is_on_route?J.a:R.a:e.is_on_route?B.a:O.a;case"fire":return e.bearing>90||e.bearing<=270?e.is_on_route?K.a:M.a:e.is_on_route?H.a:L.a;case"hospital":return e.bearing>90||e.bearing<=270?e.is_on_route?V.a:P.a:e.is_on_route?q.a:N.a}}},{key:"closeAction",value:function(e){this.setState({action:"close",action_message:""})}},{key:"closeSideBar",value:function(e){this.setState({play_sound:!1,side_bar_open:!1,location_side_bar_open:!1,agent_side_bar_open:!1,selected_location:{},selected_emergency:{},clicked_marker_id:""})}},{key:"closeAgentSideBar",value:function(e){this.setState({clicked_agent:{},agent_side_bar_open:!1})}},{key:"closeRouteResponse",value:function(e){this.setState(function(t){var n=t.route_responses_from_agents;return n.splice(n.indexOf(e),1),{route_responses_from_agents:n}})}},{key:"fetchPlaces",value:function(e,t){}},{key:"getAllAgentsLocation",value:function(){this.pubnub.subscribe({channels:this.state.channels_list}),this.setState({laser_agents:[]}),this.pubnub.publish({message:{pn_gcm:{data:{notification_body:"Tap to open the Laser App",data:{},action:"send_location"}}},channel:this.state.tracked_area,sendByPost:!1,storeInHistory:!1},function(e,t){})}},{key:"componentWillUnmount",value:function(){this.pubnub.unsubscribe({channels:this.state.channels_list})}},{key:"componentDidMount",value:function(){var e=this,t=Ve.getSelectedAgents();null!==t&&t.length>0&&this.setState({selected_agents:t}),this.pubnub.subscribe({channels:this.state.channels_list}),this.getAllAgentsLocation(),this.pubnub.addListener({status:function(e){},message:function(t){if(t.channel===e.state.tracked_user_id&&t.userMetadata&&"user_location_update"===t.userMetadata.action){var n=e.state.emergencies.map(function(n){return n.user===e.state.tracked_user_id?(n.latitude=t.message.latitude,n.longitude=t.message.longitude,n):n});e.setState(function(e){return{emergencies:n}})}if(t.channel===e.state.tracked_area&&t.userMetadata&&"agent_location_update"===t.userMetadata.action){var a=e.state.laser_agents,s=e.state.laser_agents.find(function(e){return e.agent._id===t.message.agent._id});e.state.laser_agents.length<=0||!s?a.push(t.message):a=e.state.laser_agents.map(function(n){if(n.agent._id===t.message.agent._id){var a=e.state.selected_agents.find(function(e){return e.agent._id===t.message.agent._id});return t.message.is_on_route=!!a&&a.is_on_route,t.message}a=e.state.selected_agents.find(function(e){return e.agent._id===n.agent._id});return n.is_on_route=!!a&&a.is_on_route,n}),e.setState(function(e){return{laser_agents:a}})}e.state.selected_agents.length>0&&e.state.selected_agents.forEach(function(n,a){n.agent._id===t.channel&&(t.userMetadata&&"route_request_response"===t.userMetadata.action&&(!0===t.message.response?e.setState(function(t){var s=t.selected_agents;return s[a].is_on_route=!0,Ve.saveSelectedAgents(s),{selected_agents:s,action:"message",action_message:"Agent "+n.agent.firstname+" "+n.agent.lastname+" is now en route to "+e.state.clicked_user.full_name+"'s location"}}):e.setState(function(t){var s=t.selected_agents;return s[a].is_on_route=!1,Ve.saveSelectedAgents(s),{selected_agents:s,action:"message",action_message:"Agent "+n.agent.firstname+" "+n.agent.lastname+" declined the request to go to "+e.state.clicked_user.full_name+"'s location"}})),t.userMetadata&&"route_completed"===t.userMetadata.action&&t.message&&e.setState(function(e){var a=e.route_responses_from_agents,s=t.message;return a.push({user:s,agent:n}),{route_responses_from_agents:a}}))})}});var n=ee()("http://52.59.255.174");n.on("connect",function(){return console.log("connected to socket io")}),n.on("emergency",function(t){t&&e.setState(function(e){var n=e.emergencies,a=e.latest;return a.push(t),n.push(t),{play_sound:!0,latest:a,clicked_marker_id:t._id,zoom:18,emergencies:n,center:{lat:t.latitude,lng:t.longitude}}})}),n.on("call",function(t){t&&e.setState(function(e){var n=e.locations,a=e.latest;return a.push(t),n.push(t),{play_sound:!0,latest:a,clicked_marker_id:t._id,zoom:18,locations:n,center:{lat:t.latitude,lng:t.longitude}}})}),this.getLocations(),this.getEmergencies()}},{key:"getLocationsDate",value:function(){var e=Object(b.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We({date:t});case 2:if("error"!=(n=e.sent)){e.next=6;break}return this.setState({action:"err_calls_load",locations:[],filtered_locations:[]}),e.abrupt("return");case 6:n&&n.data&&n.data.locations?(console.log({response:n}),"loading"===this.state.action?this.setState({action:"close",locations:n.data.locations,filtered_locations:n.data.locations}):this.setState({locations:n.data.locations,filtered_locations:n.data.locations})):this.setState({action:"close",locations:[],filtered_locations:[]});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEmergenciesDate",value:function(){var e=Object(b.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ke({date:t});case 2:if("error"!=(n=e.sent)){e.next=6;break}return this.setState({action:"err_emergency_load",emergencies:[],filtered_emergencies:[]}),e.abrupt("return");case 6:n&&n.data&&n.data.emergencies?(console.log({response:n}),"loading"===this.state.action?this.setState({action:"close",emergencies:n.data.emergencies,filtered_emergencies:n.data.emergencies}):this.setState({emergencies:n.data.emergencies,filtered_emergencies:n.data.emergencies})):this.setState({action:"close",emergencies:[],filtered_emergencies:[]});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getLatestLocations",value:function(){var e=Object(b.a)(p.a.mark(function e(){var t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,We({date:Qe});case 3:if("error"!=(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:n&&n.data&&n.data.locations&&n.data.locations.length>0&&t.setState(function(e){for(var t=e.latest,a=0;a<n.data.locations.length;a++)t.push(n.data.locations[a]);return{latest:t=Ge.sortDates(t)}});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getLatestEmergencies",value:function(){var e=Object(b.a)(p.a.mark(function e(){var t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,Ke({date:Qe});case 3:if("error"!=(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:n&&n.data&&n.data.emergencies&&n.data.emergencies.length>0&&t.setState(function(e){for(var t=e.latest,a=0;a<n.data.emergencies.length;a++)t.push(n.data.emergencies[a]);return{latest:t=Ge.sortDates(t)}});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getEmergencies",value:function(){var e=Object(b.a)(p.a.mark(function e(){var t,n=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ke({date:Qe});case 2:if("error"!=(t=e.sent)){e.next=6;break}return this.setState({action:"err_emergency_load",emergencies:[],filtered_emergencies:[]}),e.abrupt("return");case 6:t&&t.data&&t.data.emergencies&&t.data.emergencies.length>0?this.setState(function(e){for(var a=e.latest,s=0;s<t.data.emergencies.length;s++)a.push(t.data.emergencies[s]);return a=Ge.sortDates(a),"loading"===n.state.action?{action:"close",latest:a,emergencies:t.data.emergencies,filtered_emergencies:t.data.emergencies}:{latest:a,emergencies:t.data.emergencies,filtered_emergencies:t.data.emergencies}}):this.setState({action:"close",emergencies:[],filtered_emergencies:[]});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getLocations",value:function(){var e=Object(b.a)(p.a.mark(function e(){var t,n=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We({date:Qe});case 2:if("error"!=(t=e.sent)){e.next=6;break}return this.setState({action:"err_calls_load",locations:[],filtered_locations:[]}),e.abrupt("return");case 6:t&&t.data&&t.data.locations&&t.data.locations.length>0?this.setState(function(e){for(var a=e.latest,s=0;s<t.data.locations.length;s++)a.push(t.data.locations[s]);return a=Ge.sortDates(a),"loading"===n.state.action?{action:"close",latest:a,locations:t.data.locations,filtered_locations:t.data.locations}:{latest:a,locations:t.data.locations,filtered_locations:t.data.locations}}):this.setState({action:"close",locations:[],filtered_locations:[]});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleSongFinishedPlaying",value:function(){this.setState({play_sound:!1})}},{key:"render",value:function(){var e,t,n;return e=this.state.play_sound?s.a.createElement(Pe.a,{url:$.a,playStatus:Pe.a.status.PLAYING,playFromPosition:1,onLoading:this.handleSongLoading,onPlaying:this.handleSongPlaying,onFinishedPlaying:this.handleSongFinishedPlaying}):"",t=this.state.location_side_bar_open?s.a.createElement(me,{closeSidebar:this.closeSideBar,location:this.state.clicked_user,resolve:this.showConfirmResolveEmergency}):"",n=this.state.side_bar_open?s.a.createElement(re,{closeSidebar:this.closeSideBar,emergency:this.state.clicked_user,startMonitoring:this.startMonitoring,resolve:this.showConfirmResolveEmergency}):"",s.a.createElement("div",{className:"laser-parent-div",style:Ze},s.a.createElement(xe,{latest:this.state.latest,latestClicked:this.latestClicked}),t,n,this.state.agent_side_bar_open?s.a.createElement(de,{removeAgentFromRoute:this.removeAgentFromRoute,closeAgentSideBar:this.closeAgentSideBar,addAgentToMonitoring:this.addAgentToMonitoring,agent:this.state.clicked_agent,user:this.state.clicked_user}):"",s.a.createElement(fe,{logout:this.logout,onCalendarOpen:this.onCalendarOpen,onDateChange:this.onDateChange,date:this.state.date,selected_call:this.state.selected_call,onCallsChanged:this.onCallsChanged,selected_emergency:this.state.selected_emergency,onEmergenciesChanged:this.onEmergenciesChanged,getAllAgentsLocation:this.getAllAgentsLocation}),e,s.a.createElement(Q.Map,{google:this.props.google,style:Ze,onReady:this.fetchPlaces,initialCenter:this.state.center,center:this.state.center,zoom:this.state.zoom},this.getLocationsMarkers(),this.getEmergenciesMarkers(),this.getAgentMarkers()),s.a.createElement(le,{action:this.state.action,closeAction:this.closeAction,message:this.state.action_message}),this.state.route_responses_from_agents.length>0?s.a.createElement(Ne,{route_response:this.state.route_responses_from_agents[this.state.route_responses_from_agents.length-1],removeAgentFromRouteAndCloseRouteResponse:this.removeAgentFromRouteAndCloseRouteResponse,closeRouteResponse:this.closeRouteResponse}):"",!0===this.state.showConfirm.status?s.a.createElement(Fe,{yesClicked:"emergency"===this.state.showConfirm.action?this.resolveEmergency:this.resolveCall,noClicked:this.hideConfirm,message:this.state.message}):"")}}]),t}(a.Component),et=Object(Q.GoogleApiWrapper)({apiKey:"AIzaSyADNxHcgsHDyx_OSbqxBg5xB5lV2YJDcKI"})(Xe);new ae;a.Component,n(282);var tt=n(127),nt=n.n(tt);Se.a.setAppElement("#main");var at={display:"block",margin:"0 auto",border:"0px solid #000000"};function st(e){return s.a.createElement("div",null,s.a.createElement(Se.a,{isOpen:e.isLoading,className:"LoadingModal",overlayClassName:"LoadingOverlay",contentLabel:"Minimal Modal Example"},s.a.createElement(nt.a,{css:at,sizeUnit:"px",size:80,color:"#2E86C1",loading:e.isLoading})))}var rt={marginLeft:"8px",marginRight:"8px"},it=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={agents:[],departments:[],agents_filter:[],selected_department:"",selected_agent:{},showConfirm:!1,showAddAgent:!1,showDeleteAgent:!1,showEditAgent:!1,showDepartments:!1,confirmMessage:"",isLoading:!1},n.getAgents=n.getAgents.bind(Object(d.a)(n)),n.getAgentsDepartment=n.getAgentsDepartment.bind(Object(d.a)(n)),n.getDepartments=n.getDepartments.bind(Object(d.a)(n)),n.deleteAgent=n.deleteAgent.bind(Object(d.a)(n)),n.closeModal=n.closeModal.bind(Object(d.a)(n)),n.showDeleteAgent=n.showDeleteAgent.bind(Object(d.a)(n)),n.showAddAgent=n.showAddAgent.bind(Object(d.a)(n)),n.showEditAgent=n.showEditAgent.bind(Object(d.a)(n)),n.showDepartments=n.showDepartments.bind(Object(d.a)(n)),n.onDepartmentChanged=n.onDepartmentChanged.bind(Object(d.a)(n)),n.showLoading=n.showLoading.bind(Object(d.a)(n)),n.hideLoading=n.hideLoading.bind(Object(d.a)(n)),n}return Object(g.a)(t,e),Object(l.a)(t,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"getAgents",value:function(){var e=Object(b.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,Je("/get_agents").then(function(e){return e}).catch(function(e){return console.log({err:e}),"error"});case 3:if(t=e.sent,this.hideLoading(),"error"!==t){e.next=7;break}return e.abrupt("return");case 7:t&&t.data&&t.data.length>0&&this.setState({agents:t.data});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAgentsDepartment",value:function(){var e=Object(b.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,Je("/get_agents_departments",{department:t}).then(function(e){return e}).catch(function(e){return console.log({err:e}),"error"});case 3:if(n=e.sent,this.hideLoading(),"error"!==n){e.next=7;break}return e.abrupt("return");case 7:n&&n.data&&n.data.length>0&&this.setState({agents:n.data});case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getDepartments",value:function(){var e=Object(b.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,Je("/get_departments").then(function(e){return e}).catch(function(e){return"error"});case 3:if(t=e.sent,this.hideLoading(),"error"!==t){e.next=7;break}return e.abrupt("return");case 7:t&&t.data&&t.data.length>0&&this.setState(function(e){var n=["all"];return t.data.map(function(e){n.push(e.name)}),{departments:n}});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"deleteAgent",value:function(){var e=Object(b.a)(p.a.mark(function e(t){var n,a=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,s=t._id,Je("/delete_agent",{id:s}).then(function(e){return e}).catch(function(e){return console.log(e),"error"});case 3:if(n=e.sent,this.hideLoading(),"error"!==n){e.next=7;break}return e.abrupt("return");case 7:n&&n.data&&n.data.length>0&&this.setState(function(e){var n=a.state.agents;return n.splice(a.agents.indexOf(t),1),{agents:n}});case 8:case"end":return e.stop()}var s},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"closeModal",value:function(){this.setState({showConfirm:!1,showAddAgent:!1,showDeleteAgent:!1,showEditAgent:!1,showDepartments:!1})}},{key:"showDeleteAgent",value:function(e){this.setState({selected_agent:e,showConfirm:!0,confirmMessage:"Are you sure you want to delete agent "+e.firstname+"'s profile? This cant be undone."})}},{key:"showAddAgent",value:function(){this.state.setState({showAddAgent:!0})}},{key:"showEditAgent",value:function(e){this.state.setState({showEditAgent:!0,selected_agent:e})}},{key:"showDepartments",value:function(){}},{key:"onDepartmentChanged",value:function(e){var t=e.target.value;this.setState({selected_department:t}),"all"===t?this.getAgents():this.getAgentsDepartment(t)}},{key:"componentDidMount",value:function(){this.getAgents(),this.getDepartments()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"laser-parent-div"},s.a.createElement("div",{className:"laser-top-panel"},s.a.createElement("h4",{className:"laser-inline"},"Laser Emergency Admin Platform"),s.a.createElement("div",{className:"laser-controls"},s.a.createElement(m.b,{to:"/app/orders",className:"nav-link white-text link"},s.a.createElement("h5",null,"View Map")),s.a.createElement("button",{onClick:function(t){return e.props.logout(t)},className:"form-control laser-inline laser-100-width laser-grey-bg laserbtn text-right pull-right"},"logout"))),s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-3 col-sm-3"},s.a.createElement("select",{style:rt,className:"form-control laser-inline laser-150-width",id:"filter",name:"filter",value:this.state.selected_department,onChange:this.onDepartmentChanged},this.state.departments.map(function(e){return s.a.createElement("option",null,e)}))),s.a.createElement("div",{className:"col-md-2 col-sm-2 col-md-offset-2 col-sm-offset-2"},s.a.createElement("button",{className:"laserbtn laser-blue-bg"},"Add Agent")),s.a.createElement("div",{className:"col-md-3 col-sm-3"},s.a.createElement("button",{className:"laserbtn laser-blue-bg"},"Departments"))),s.a.createElement(st,{isLoading:this.state.isLoading})))}}]),t}(a.Component),ot=n(130),lt=new Ue,ct={marginBottom:"0px",marginTop:"0px"},ut=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={username:"",password:"",error:"",isLoading:!1},n.submitClicked=n.submitClicked.bind(Object(d.a)(n)),n.onFieldChanged=n.onFieldChanged.bind(Object(d.a)(n)),n.showLoading=n.showLoading.bind(Object(d.a)(n)),n.hideLoading=n.hideLoading.bind(Object(d.a)(n)),n}return Object(g.a)(t,e),Object(l.a)(t,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"submitClicked",value:function(){var e=Object(b.a)(p.a.mark(function e(t,n){var a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),this.setState({error:""}),!(this.state.username.length<=0||this.state.password.length<=0)){e.next=5;break}return this.setState({error:"Please make sure all fields are completed"}),e.abrupt("return");case 5:return this.showLoading(),e.next=8,lt.login(this.state.username,this.state.password);case 8:if(a=e.sent,this.hideLoading(),"error"!==a){e.next=13;break}return this.setState({error:"An error occurred login you in. Please try again later."}),e.abrupt("return");case 13:a&&a.data&&(this.props.login(),this.props.history.push("/"));case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onFieldChanged",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,a=t.name;this.setState(Object(ot.a)({},a,n))}},{key:"render",value:function(){return s.a.createElement("div",{className:"laser-login-bg"},s.a.createElement("div",{className:"laser-login-div laser-shadow"},s.a.createElement("h2",{className:"bt-blue-text laser-white-text",style:ct},"Admin"),s.a.createElement("h2",{className:"bt-blue-text laser-white-text",style:ct},"Login"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("h5",{className:"laser-red-text"},this.state.error?this.state.error:""),s.a.createElement("br",null),s.a.createElement("label",{className:"laser-white-text",htmlFor:"category"},s.a.createElement("h5",null,"User Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"username",type:"text",name:"username",onChange:this.onFieldChanged,value:this.state.username,className:"form-control bt-login-input",placeholder:"User Name"}),s.a.createElement("br",null),s.a.createElement("label",{className:"laser-white-text",htmlFor:"category"},s.a.createElement("h5",null,"Password")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"password",type:"password",name:"password",onChange:this.onFieldChanged,value:this.state.password,className:"form-control bt-login-input",placeholder:"Password"}),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-blue-bg laserbtn",onClick:this.submitClicked},"CONTINUE")),s.a.createElement(st,{isLoading:this.state.isLoading}))}}]),t}(a.Component),dt=new Ue,gt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).logout=function(){dt.logout(),n.setState({isLogin:!0})},n.login=function(){n.setState({isLogin:!1})},n.state={isLogin:!1},n.logout=n.logout.bind(Object(d.a)(n)),n.login=n.login.bind(Object(d.a)(n)),n}return Object(g.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(m.a,null,s.a.createElement(h.b,{path:"/",exact:!0,render:function(t){return!0===dt.loggedIn()?s.a.createElement(et,Object.assign({},t,{logout:e.logout})):s.a.createElement(h.a,{to:"/login",login:e.login})}}),s.a.createElement(h.b,{path:"/agents",exact:!0,render:function(t){return!0===dt.loggedIn()?s.a.createElement(it,Object.assign({},t,{logout:e.logout})):s.a.createElement(h.a,{to:"/login",login:e.login})}}),s.a.createElement(h.b,{path:"/departments",exact:!0,render:function(t){return!0===dt.loggedIn()?s.a.createElement(it,Object.assign({},t,{logout:e.logout})):s.a.createElement(h.a,{to:"/login",login:e.login})}}),s.a.createElement(h.b,{path:"/login",exact:!0,render:function(t){return!1===dt.loggedIn()?s.a.createElement(ut,Object.assign({},t,{login:e.login})):s.a.createElement(h.a,Object.assign({to:"/"},t,{logout:e.logout}))}}),1==this.state.isLogin?s.a.createElement(h.a,{to:"/login",login:this.login}):""))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(gt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[131,1,2]]]);
//# sourceMappingURL=main.a34d6a97.chunk.js.map