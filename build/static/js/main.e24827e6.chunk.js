(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{106:function(e,t,n){e.exports=n.p+"static/media/emergency_with_circle.0153b7ea.gif"},107:function(e,t,n){e.exports=n.p+"static/media/call_with_circle.34c87478.gif"},108:function(e,t,n){e.exports=n.p+"static/media/emergency.445ccffb.gif"},109:function(e,t,n){e.exports=n.p+"static/media/call.37865c67.gif"},110:function(e,t,n){e.exports=n.p+"static/media/police_car.d5d82e20.png"},111:function(e,t,n){e.exports=n.p+"static/media/police_car_using.303f7897.png"},112:function(e,t,n){e.exports=n.p+"static/media/police_car_other_using.fa5d0303.png"},113:function(e,t,n){e.exports=n.p+"static/media/police_car_in_focus.97936b46.png"},114:function(e,t,n){e.exports=n.p+"static/media/fire_truck.1171957d.png"},115:function(e,t,n){e.exports=n.p+"static/media/fire_truck_using.a665c769.png"},116:function(e,t,n){e.exports=n.p+"static/media/fire_truck_other_using.ac03affc.png"},117:function(e,t,n){e.exports=n.p+"static/media/fire_truck_in_focus.6613578d.png"},118:function(e,t,n){e.exports=n.p+"static/media/ambulance.2c93e510.png"},119:function(e,t,n){e.exports=n.p+"static/media/ambulance_using.8b74e8df.png"},120:function(e,t,n){e.exports=n.p+"static/media/ambulance_other_using.a3b0b90e.png"},121:function(e,t,n){e.exports=n.p+"static/media/ambulance_in_focus.49e0e4aa.png"},122:function(e,t,n){e.exports=n.p+"static/media/alert.77e4ae16.mp3"},126:function(e,t,n){e.exports=n.p+"static/media/manual_call.8e6b2365.png"},127:function(e,t,n){e.exports=n.p+"static/media/locate_agents.97c154a2.png"},128:function(e,t,n){e.exports=n.p+"static/media/emergency_monitored.e09b1624.png"},129:function(e,t,n){e.exports=n.p+"static/media/logout.64c75d4b.png"},135:function(e,t,n){e.exports=n(301)},141:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},142:function(e,t,n){e.exports=n.p+"static/media/car_test.4b63a07a.png"},183:function(e,t){},240:function(e,t,n){e.exports=n.p+"static/media/burger_menu.f128647b.png"},241:function(e,t,n){e.exports=n.p+"static/media/phone_white.60b8def5.png"},297:function(e,t,n){},298:function(e,t){},301:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(20),i=n.n(r),l=n(5),o=n(6),c=n(1),d=n(7),u=n(8),m=n(12),g=n(19),h=n(16),p=n(2),b=n.n(p),f=n(4),_=(n(141),n(106)),v=n.n(_),E=n(107),y=n.n(E),k=n(108),w=n.n(k),A=n(109),C=n.n(A),x=(n(142),n(110)),N=n.n(x),S=n(111),L=n.n(S),O=n(112),M=n.n(O),j=n(113),D=n.n(j),F=n(114),P=n.n(F),R=n(115),I=n.n(R),T=n(116),G=n.n(T),B=n(117),q=n.n(B),z=n(118),U=n.n(z),Y=n(119),H=n.n(Y),W=n(120),J=n.n(W),V=n(121),K=n.n(V),Z=n(122),$=n.n(Z),Q=n(29),X=n(123),ee=n.n(X),te=n(61),ne=n.n(te),ae=function(){function e(){Object(l.a)(this,e)}return Object(o.a)(e,[{key:"getDate",value:function(e){return ne()(e).utc().format("YYYY - MM - DD")}},{key:"getTime",value:function(e){return ne()(e).utc().format("HH:mm:ss")}},{key:"sortDates",value:function(e){return e.sort((function(e,t){return new Date(e.created)-new Date(t.created)})),e}},{key:"updateAgentLocation",value:function(e,t,n,a){return new Promise((function(s,r){(function(e,t,n,a){return new Promise((function(s,r){var i=!1,l=[];0===t.length?se(a,e,n).then((function(t){var n=Object.assign(e,{status:t});l.push(n),s(l)})).catch((function(t){var n=Object.assign(e,{status:"idle"});l.push(n),s(l)})):t.map((function(r,o){if(r.agent._id===e.agent._id){i=!0;var c=Object.assign(e,{status:r.status});l.push(c)}else l.push(r);o===t.length-1&&(i||se(a,e,n).then((function(t){var n=Object.assign(e,{status:t});l.push(n),s(l)})).catch((function(t){var n=Object.assign(e,{status:"idle"});l.push(n),s(l)})))}))}))})(e,t,n,a).then((function(e){s(e)})).catch((function(e){r(e)}))}))}},{key:"checkIfEmergencyMonitoredByOtherAdmin",value:function(e,t,n){return new Promise((function(a,s){var r=!1;e.length>0?e.map((function(s,i){s&&(s.admin_id!==n&&s.emergency._id===t._id&&(r=!0),i===e.length-1&&a(r))})):a(r)}))}},{key:"setEmergencyOnMonitoringGrid",value:function(e,t,n){return new Promise((function(a,s){var r=!1;if(t.length>0){var i=[];t.map((function(s,l){s&&(s.admin_id===n?(r=!0,s={admin_id:n,emergency:e,agents:s.agents},i.push(s)):i.push(s),l===t.length-1&&(r||i.push({admin_id:n,emergency:e,agents:[]}),a(i)))}))}else t.push({admin_id:n,emergency:e,agents:[]}),a(t)}))}},{key:"setAgentOnMonitoringGridAndChangeAgentStatus",value:function(e,t,n,a){return new Promise((function(s,r){if(t.length>0){var i=[];t.map((function(r,l){if(r&&(r.admin_id===n?(!0,-1===r.agents.indexOf(e.agent._id)&&r.agents.push(e.agent._id),i.push(r)):i.push(r),l===t.length-1)){for(var o=0;o<a.length;o++)if(a[o].agent._id===e.agent._id){a[o].status="using";break}s([i,a])}}))}else s(t,a)}))}},{key:"checkIfEmergencyMonitoredByBrowserAdmin",value:function(e,t){return new Promise((function(n,a){var s=!1;t.length>0?t.map((function(a,r){a&&(a.admin_id===e&&a.emergency&&(s=!0),r===t.length-1&&n(s))})):n(s)}))}},{key:"setAgentsInFocus",value:function(e,t,n){return new Promise((function(a,s){var r=[];n.map((function(s,i){s.sub_admin_address&&t.sub_admin_address&&s.sub_admin_address===t.sub_admin_address?("using"!==s.status&&"using_by_other"!==s.status&&(s.status="infocus"),-1===e.indexOf(s.agent._id)&&e.push(s.agent._id),r.push(s)):r.push(s),i===n.length-1&&a([r,e])}))}))}},{key:"checkIfOtherAdminIsUsingAgent",value:function(e,t,n){return new Promise((function(a,s){var r=!1;if(n.length>0)for(var i=0;i<n.length;i++){var l=n[0];if(l){if(l.admin_id!==e&&-1!==l.agents.indexOf(t.agent._id)){a(r=!0);break}i===n.length-1&&a(r)}}else a(r)}))}},{key:"getAdminEmergencyMonitored",value:function(e,t){return new Promise((function(n,a){if(t.length>0)for(var s=0;s<t.length;s++){var r=t[s];if(r){if(r.admin_id===e){n(r);break}s===t.length-1&&n(null)}}else n(null)}))}},{key:"addAgentToListOfAssignedAgentsForPersistence",value:function(e,t){if(t&&t.length>0){var n=!1;t.map((function(a,s){a.agent._id===e.agent._id&&(n=!0,t.splice(s,1,e))})),n||t.push(e)}else(t=[]).push(e);return t}},{key:"removeAgentFromListOfAssignedAgentsForPersistsnce",value:function(e,t){return t&&t.length>0?t.map((function(n,a){n.agent._id===e.agent._id&&t.splice(a,1)})):(t=[]).push(e),t}},{key:"reconcileAssignedAgentsListWithMonitoringGrid",value:function(e,t,n){return new Promise((function(a,s){var r=[];if(n.length>0){for(var i,l=[],o=0;o<n.length;o++)if(n[o].admin_id===e){i=n[o].agents.concat([]);break}i&&i.length>0?(t.map((function(e){-1!==i.indexOf(e.agent._id)&&(r.push(e),l.push(e))})),a([l,r])):a([l,r=[]])}else a([t,r])}))}},{key:"reconcileAllAgentsWithMonitoringGrid",value:function(e,t,n){return new Promise((function(a,s){var r=[];e.length>0?e.map((function(s,i){se(n,s,t).then((function(t){var n=Object.assign(s,{status:t});r.push(n),i===e.length-1&&a(r)})).catch((function(t){r.push(s),i===e.length-1&&a(r)}))})):a([])}))}},{key:"removeAgentFromBrowserAdminMonitoringGrid",value:function(e,t,n,a){return new Promise((function(s,r){if(n.length>0)for(var i=[],l=0;l<n.length;l++){if(n[l].admin_id===t){if(-1!==n[l].agents.indexOf(e.agent._id)&&n[l].agents.splice(n[l].agents.indexOf(e.agent._id),1),i.push(n[l]),a.length>0)for(var o=0;o<a.length;o++)if(a[o].agent._id===e.agent._id){e.status="idle",a.splice(o,1,e);break}}else i.push(n[l]);l===n.length-1&&s([i,a])}else s([n,a])}))}},{key:"getAgentFromAssignedAgentsInPersistence",value:function(e,t){return new Promise((function(n,a){for(var s=0;s<e.length;s++)if(e[s].agent._id===t){n(e[s]);break}n(null)}))}}]),e}();function se(e,t,n){return new Promise((function(a,s){if(n.length>0)for(var r=0;r<n.length;r++){var i=n[r];if(i){if(i.admin_id===e){if(-1!==i.agents.indexOf(t.agent._id)){a("using");break}}else if(-1!==i.agents.indexOf(t.agent._id)){a("using_by_other");break}r===n.length-1&&a("idle")}}else a("idle")}))}var re=n(124),ie=n.n(re),le=n(62),oe=n.n(le),ce=function e(){var t=this;Object(l.a)(this,e),this.login=function(e,n){return t.axios("/login",{username:e,password:n}).then((function(e){return t.setToken(e.data.token),t.setPriviledge(e.data.priviledge),t.setAdmin(e.data.admin),console.log(e.data),e})).catch((function(e){return"error"}))},this.loggedIn=function(){var e=t.getToken();return!!e&&!t.isTokenExpired(e)},this.isTokenExpired=function(e){try{return oe()(e).exp<Date.now()/1e3}catch(t){return console.log("expired check failed! Line 42: AuthService.js"),!1}},this.setAdmin=function(e){localStorage.setItem("admin",JSON.stringify(e))},this.getAdmin=function(){return JSON.parse(localStorage.getItem("admin"))},this.setToken=function(e){localStorage.setItem("id_token",e)},this.getToken=function(){return localStorage.getItem("id_token")},this.logout=function(){localStorage.removeItem("id_token")},this.getConfirm=function(){var e=oe()(t.getToken());return console.log("Recieved answer!"),e},this.setPriviledge=function(e){localStorage.setItem("priviledge",e)},this.getPriviledge=function(){return localStorage.getItem("priviledge")},this.axios=function(e,n,a){a||(a="post");var s={Accept:"application/json","Content-Type":"application/json"};return t.loggedIn()&&(s.Authorization="Bearer:"+t.getToken()),ie()({url:e,method:a,data:n,baseURL:"http://3.121.181.120/admin",timeout:3e4,headers:s}).then(t._checkStatus).then((function(e){return e})).catch((function(e){return e}))},this._checkStatus=function(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}},de=new ae,ue=new ce;function me(e){return s.a.createElement("div",{className:"laser-side-bar"},s.a.createElement("h1",{className:"close_btn",onClick:function(t){return e.closeSidebar(t)}},"\u2715"),s.a.createElement("br",null),s.a.createElement("h4",{className:"text-center laser-red-text"},s.a.createElement("b",null,"Emergency Location Details")),s.a.createElement("br",null),"full_control"===ue.getPriviledge()?s.a.createElement("div",null,s.a.createElement("button",{className:"laser-red-bg laserbtn",onClick:function(t){return e.startMonitoring(t,e.emergency)}},"Start Monitoring"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-blue-bg laserbtn",onClick:function(t){return e.resolve(t)}},"Resolve")):"",s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Trackable")," - ",e.emergency.is_trackable?"Yes":"No"),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Time")," - ",de.getTime(e.emergency.created)),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Persons Name")," - ",e.emergency.full_name),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Person's Emergency Contacts")," - ",e.emergency.emergency_numbers&&e.emergency.emergency_numbers.length>0?e.emergency.emergency_numbers.map((function(e,t){return s.a.createElement("p",{key:t},e)})):""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Email Address")," - ",e.emergency.email?e.emergency.email:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Phone Number")," - ",e.emergency.phone_number?e.emergency.phone_number:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Device")," - ",e.emergency.device?e.emergency.device:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Emergency Full Address")," - ",e.emergency.full_address?e.emergency.full_address:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Emergency Admin Address")," - ",e.emergency.sub_admin_address?e.emergency.sub_admin_address:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Reason For Emergency")," - ",e.emergency.reasons?function(e){switch(e.length){case 0:return"";case 1:return e[0]+" emergency";case 2:return e[0]+" emergency, "+e[1]+" emergency";case 3:return e[0]+" emergency, "+e[1]+" emergency, "+e[2]+" emergency"}}(e.emergency.reasons):""))}var ge={width:"100%"};function he(e){return s.a.createElement("div",{className:"laser-action_div laser-shadow"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h1",{style:ge},s.a.createElement("span",{onClick:function(t){return e.closeAction(t)},className:"action_close_btn"},"\u2715"))),s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h5",null,e.text))))}function pe(e){return s.a.createElement("div",null,function(e,t,n){switch(e){case"loading":return s.a.createElement(he,{text:"Loading...",closeAction:n});case"close":return"";case"err_calls_load":return s.a.createElement(he,{text:"An Error occurred loading latest calls",closeAction:n});case"err_emergency_load":return s.a.createElement(he,{text:"An Error occurred loading latest emergencies",closeAction:n});case"message":return s.a.createElement(he,{text:t,closeAction:n})}}(e.action,e.message,e.closeAction))}var be=new ce,fe={background:"#2E86C1",border:"0px solid #000000",color:"#FFFFFF",padding:"8px",borderRadius:"4px"},_e={background:"#000000",border:"0px solid #000000",color:"#FFFFFF",padding:"8px",borderRadius:"4px"};function ve(e){return s.a.createElement("div",{className:"laser-agent_side-bar"},s.a.createElement("h1",{className:"close_btn",onClick:function(t){return e.closeAgentSideBar(t)}},"\u2715"),s.a.createElement("br",null),s.a.createElement("h4",{className:"text-center laser-black-text"},s.a.createElement("b",null,"Agents Details")),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Agents Name")," - ",e.agent.agent.firstname," ",e.agent.agent.lastname),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Phone Number")," - ",e.agent.agent.phone_number),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Agency")," - ",e.agent.agent.department),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Current Location")," - ",e.agent.full_address),s.a.createElement("br",null),"full_control"===be.getPriviledge()?s.a.createElement("div",null,s.a.createElement("h5",null,s.a.createElement("b",null,"Availability")," - ",e.agent.is_on_route?e.agent.agent.firstname+" is currently monitoring an emergency":e.agent.agent.firstname+" is available"),s.a.createElement("p",null,"using"===e.agent.status?s.a.createElement("button",{style:_e,onClick:function(t){return e.removeAgentFromRoute(t,e.agent)},className:""},"Remove agent from route"):""),s.a.createElement("br",null),e.user.full_name?s.a.createElement("button",{style:fe,onClick:function(t){return e.addAgentToMonitoring(t,e.agent)},className:""},"Send Agent ",e.agent.agent.firstname," ",e.agent.agent.lastname," to ",e.user.full_name,"'s location "):""):"")}var Ee=new ae,ye=new ce;function ke(e){return s.a.createElement("div",{className:"laser-side-bar"},s.a.createElement("h1",{className:"close_btn",onClick:function(t){return e.closeSidebar(t)}},"\u2715"),s.a.createElement("br",null),s.a.createElement("h4",{className:"text-center laser-blue-text"},s.a.createElement("b",null,"Call Location Details")),s.a.createElement("br",null),"full_control"===ye.getPriviledge()?s.a.createElement("div",null,s.a.createElement("button",{className:"laser-red-bg laserbtn",onClick:function(t){return e.startMonitoring(t,e.location)}},"Start Monitoring"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-blue-bg laserbtn",onClick:function(t){return e.resolve(t)}},"Resolve")):"",s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Time")," - ",Ee.getTime(e.location.created)),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Persons Name")," - ",e.location.full_name),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Email Address")," - ",e.location.email?e.location.email:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Phone Number")," - ",e.location.phone_number?e.location.phone_number:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Call Full Address")," - ",e.location.full_address?e.location.full_address:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Call Admin Address")," - ",e.location.sub_admin_address?e.location.sub_admin_address:""),s.a.createElement("br",null),s.a.createElement("h5",null,s.a.createElement("b",null,"Reason For Call")," - ",e.location.reason?e.location.reason:""))}new ae,new ce;var we={marginLeft:"8px",marginRight:"8px"};function Ae(e){return s.a.createElement("div",{className:"laser-side-bar"},s.a.createElement("h1",{className:"close_btn",onClick:function(t){return e.closeSidebar(t)}},"\u2715"),s.a.createElement("br",null),s.a.createElement("h4",{className:"text-center laser-blue-text"},s.a.createElement("b",null,"Add Call Manually")),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("label",{className:"laser-black-text",htmlFor:"category"},s.a.createElement("h5",null,"Full Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"manual_name",type:"text",name:"manual_name",onChange:e.onFieldChanged,value:e.manual_name,className:"form-control bt-login-input",placeholder:"Full Name"}),s.a.createElement("label",{className:"laser-black-text",htmlFor:"category"},s.a.createElement("h5",null,"Phone Number")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"manual_phone",type:"text",name:"manual_phone",onChange:e.onFieldChanged,value:e.manual_phone,className:"form-control bt-login-input",placeholder:"Phone Number"}),s.a.createElement("label",{className:"laser-black-text",htmlFor:"category"},s.a.createElement("h5",null,"Address")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"manual_address",type:"text",name:"manual_address",onChange:e.onFieldChanged,value:e.manual_address,className:"form-control bt-login-input",placeholder:"Address"}),s.a.createElement("br",null),s.a.createElement("label",{className:"laser-black-text",htmlFor:"category"},s.a.createElement("h5",null,"Reason For Call")),s.a.createElement("select",{style:we,className:"form-control laser-inline laser-150-width",id:"selected_manual_call",name:"selected_manual_call",value:e.selected_manual_call,onChange:e.onManualCallChanged},s.a.createElement("option",null,"Emergency Management(LASEMA)"),s.a.createElement("option",null,"Police"),s.a.createElement("option",null,"Distress"),s.a.createElement("option",null,"Environmental and Special Offences Task Force"),s.a.createElement("option",null,"Fire / Safety Services"),s.a.createElement("option",null,"Environmental / Noise Pollution"),s.a.createElement("option",null,"Broken Pipe / Water Leakage"),s.a.createElement("option",null,"Pothole / Collapsed Road"),s.a.createElement("option",null,"Domestic / Sexual Violence"),s.a.createElement("option",null,"None")),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("label",{className:"laser-black-text",htmlFor:"category"},s.a.createElement("h5",null,"Caller Gender")),s.a.createElement("select",{style:we,className:"form-control laser-inline laser-150-width",id:"selected_manual_gender",name:"selected_manual_gender",value:e.selected_manual_gender,onChange:e.onManualGenderChanged},s.a.createElement("option",null,"Male"),s.a.createElement("option",null,"Female")),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-blue-bg laserbtn",onClick:function(t){return e.onSubmitManualCallDetails(t)}},"Submit"))}var Ce=n(9),xe=n.n(Ce);xe.a.setAppElement("#main");var Ne={marginLeft:"16px",marginRight:"8px"},Se={marginLeft:"8px",marginRight:"16px"};function Le(e){return s.a.createElement("div",null,s.a.createElement(xe.a,{isOpen:!0,className:"ConfirmModal",overlayClassName:"Overlay",contentLabel:"Minimal Modal Example"},s.a.createElement("h4",{className:"text-center blue-text"},"Address Not Found"),s.a.createElement("br",null),s.a.createElement("h5",{className:"text-center"},"An Error occurred while attempting to locate that address. It could be that the address is wrong."),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-inline laser-red-bg laserbtn",style:Se,onClick:e.tryAgainClicked},"retry"),s.a.createElement("button",{className:"laser-inline laser-grey-bg laserbtn",style:Ne,onClick:e.closeConfirmAddressNotFoundClicked},"cancel")))}var Oe=n(125),Me=n.n(Oe),je=(n(240),n(241),n(126)),De=n.n(je),Fe=n(127),Pe=n.n(Fe),Re=n(128),Ie=n.n(Re),Te=n(129),Ge=n.n(Te),Be=new ce,qe={color:"#111111",border:"0px solid #FFFFFF",zIndex:"6000",marginLeft:"8px",marginRight:"8px",padding:"8px"},ze={marginLeft:"8px",marginRight:"8px"},Ue=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"laser-top-panel"},s.a.createElement("h4",{className:"laser-inline laser-header-text"}," Laser Emergency Admin - Monitoring and Dispatch"),s.a.createElement("div",{className:"laser-controls"},"full_control"===Be.getPriviledge()?s.a.createElement("button",{onClick:function(t){return e.props.openManualLocation(t)},className:"laser-inline laserbtn laser-transparent-btn laser-white-bg"},s.a.createElement("img",{src:De.a,width:"35",height:"35"})):"","full_control"===Be.getPriviledge()?s.a.createElement("button",{onClick:function(t){return e.props.showMonitoredEmergency(t)},className:"laser-inline laser-transparent-btn laserbtn laser-white-bg"},s.a.createElement("img",{src:Ie.a,width:"35",height:"35"})):"","full_control"===Be.getPriviledge()?s.a.createElement("button",{onClick:function(t){return e.props.getAgentsAroundEmergency(t)},className:"laser-inline laser-transparent-btn laserbtn laser-white-bg"},s.a.createElement("img",{src:Pe.a,width:"35",height:"35"})):"",s.a.createElement("div",{className:"laser-inline",style:qe},s.a.createElement(Me.a,{onCalendarOpen:this.props.onCalendarOpen,maxDate:new Date,style:qe,onChange:this.props.onDateChange,value:this.props.date})),s.a.createElement("select",{style:ze,className:"form-control laser-inline laser-150-width",id:"calls",name:"calls",value:this.props.selected_call,onChange:this.props.onCallsChanged},s.a.createElement("option",null,"Calls (All)"),s.a.createElement("option",null,"Emergency Management(LASEMA)"),s.a.createElement("option",null,"Police"),s.a.createElement("option",null,"Distress"),s.a.createElement("option",null,"Environmental and Special Offences Task Force"),s.a.createElement("option",null,"Fire / Safety Services"),s.a.createElement("option",null,"Environmental / Noise Pollution"),s.a.createElement("option",null,"Broken Pipe / Water Leakage"),s.a.createElement("option",null,"Pothole / Collapsed Road"),s.a.createElement("option",null,"Domestic / Sexual Violence"),s.a.createElement("option",null,"None")),s.a.createElement("select",{style:ze,className:"form-control laser-inline laser-150-width",id:"emergencies",name:"emergencies",value:this.props.selected_emergency,onChange:this.props.onEmergenciesChanged},s.a.createElement("option",null,"Emergencies (All)"),s.a.createElement("option",null,"Police Cases"),s.a.createElement("option",null,"Hospital Cases"),s.a.createElement("option",null,"Fire Cases"),s.a.createElement("option",null,"None")),s.a.createElement("button",{onClick:function(t){return e.props.logout(t)},className:"laser-inline laser-transparent-bg laserbtn laser-white-bg"},s.a.createElement("img",{src:Ge.a,width:"35",height:"35"}))))}}]),n}(a.Component),Ye=new ae,He={background:"rgba(0,0,0,0)",border:"0px solid #000000"};function We(e){return s.a.createElement("button",{className:"laserItem",style:He,onClick:function(t){return e.itemClicked(t,e.item)}},s.a.createElement("h5",{style:Je(e.item.laser_type)},e.item.full_name," - ",Ye.getTime(e.item.created)," - ",e.item.sub_admin_address))}function Je(e){switch(e){case"emergency":return{color:"#E74C3C",textAlign:"left"};case"call":return{color:"#3498DB",textAlign:"left"};default:return{color:"#000000",textAlign:"left"}}}var Ve=n(130),Ke=n.n(Ve),Ze={width:"380px",height:"400px"},$e=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={},a.itemClicked=a.itemClicked.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"itemClicked",value:function(e,t){e.preventDefault(),this.props.latestClicked(t)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"laser-latest-div laser-shadow"},s.a.createElement("h4",{className:"text-center laser-black-text"},"Latest Reports"),s.a.createElement(Ke.a,{style:Ze},this.props.latest.map((function(t){return s.a.createElement(We,{key:t._id,itemClicked:e.itemClicked,item:t})}))))}}]),n}(a.Component),Qe={margin:"16px"},Xe={background:"#2E86C1",border:"0px solid #000000",color:"#FFFFFF",padding:"8px",borderRadius:"4px",float:"left",marginLeft:"20px"};function et(e){return s.a.createElement("div",null,s.a.createElement(xe.a,{isOpen:!0,className:"Modal",overlayClassName:"Overlay",contentLabel:"Minimal Modal Example"},s.a.createElement("h4",{className:"text-center"},"Message From Agent"),s.a.createElement("button",{className:"grey-bg bt-btn pull-right",style:Qe,onClick:e.closeRouteResponse},"close"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-8 col-sm-8"},s.a.createElement("h5",{className:"black-text"},e.route_response.agent.agent.firstname," ",e.route_response.agent.agent.lastname," has completed the route to ",e.route_response.user.full_name,"'s location")),s.a.createElement("div",{className:"col-md-4 col-sm-4"},s.a.createElement("h5",null,s.a.createElement("b",null,"Phone Number")),s.a.createElement("h5",null,e.route_response.agent.agent.phone_number))),s.a.createElement("div",{className:"row"},s.a.createElement("h5",null,s.a.createElement("button",{className:"green-bg bt-btn",style:Xe,onClick:function(t){return e.removeAgentFromRouteAndCloseRouteResponse(t,e.route_response)}},"Remove Agent From Route")))))}xe.a.setAppElement("#main"),xe.a.setAppElement("#main");var tt={marginLeft:"16px",marginRight:"8px"},nt={marginLeft:"8px",marginRight:"16px"};function at(e){return s.a.createElement("div",null,s.a.createElement(xe.a,{isOpen:!0,className:"ConfirmModal",overlayClassName:"Overlay",contentLabel:"Minimal Modal Example"},s.a.createElement("h4",{className:"text-center blue-text"},"Confirmation"),s.a.createElement("br",null),s.a.createElement("h5",{className:"text-center"},e.message),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-inline laser-blue-bg laserbtn",style:tt,onClick:e.yesClicked},"yes"),s.a.createElement("button",{className:"laser-inline grey-bg laserbtn",style:nt,onClick:e.noClicked},"no")))}var st=function(){function e(){Object(l.a)(this,e)}return Object(o.a)(e,[{key:"saveAssignedAgents",value:function(e){localStorage.setItem("assigned_agents",JSON.stringify(e))}},{key:"getAssignedAgents",value:function(){return JSON.parse(localStorage.getItem("assigned_agents"))}},{key:"deleteAssignedAgents",value:function(){localStorage.removeItem("assigned_agents")}},{key:"saveCompletedEmergenciesResponse",value:function(e){localStorage.setItem("route_completed",JSON.stringify(e))}},{key:"getCompletedEmergenciesResponse",value:function(){return JSON.parse(localStorage.getItem("route_completed"))}}]),e}(),rt=n(63),it=n.n(rt),lt=n(131),ot=n.n(lt),ct=n(22),dt=n.n(ct),ut=n(132),mt=n.n(ut);xe.a.setAppElement("#main");var gt={display:"block",margin:"0 auto",border:"0px solid #000000"};function ht(e){return s.a.createElement("div",null,s.a.createElement(xe.a,{isOpen:e.isLoading,className:"LoadingModal",overlayClassName:"LoadingOverlay",contentLabel:"Minimal Modal Example"},s.a.createElement(mt.a,{css:gt,sizeUnit:"px",size:80,color:"#2E86C1",loading:e.isLoading})))}n(297);var pt=(new ce).axios,bt=function(e){return pt("/getLocations",e).then((function(e){return e})).catch((function(e){return console.log({err:e}),"error"}))},ft=function(e){return pt("/getEmergencies",e).then((function(e){return e})).catch((function(e){return console.log({err:e}),"error"}))},_t=function(e){return pt("/create_agent",e).then((function(e){return e})).catch((function(e){return console.log(e),"error"}))},vt=function(){return pt("/get_departments").then((function(e){return e})).catch((function(e){return"error"}))},Et=function(e){return pt("/create_admin",{name:e}).then((function(e){return e})).catch((function(e){return"error"}))},yt=function(e){return pt("/setMonitorings",{monitorings:e}).then((function(e){return e})).catch((function(e){return"error"}))},kt=function(){return pt("/getMonitorings",{},"get").then((function(e){return e})).catch((function(e){return"error"}))},wt=new ae,At=new st,Ct={height:"100vh",width:"100%"},xt=(new Date).toISOString(),Nt=null,St=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(l.a)(this,n),(a=t.call(this,e)).state={showConfirm:{action:"",status:!1},latest:[],locations:[],emergencies:[],filtered_locations:[],filtered_emergencies:[],side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!1,manual_location_side_bar:!1,clicked_user:{},clicked_agent:{},center:{lat:6.5244,lng:3.3792},selected_call:"Calls (All)",selected_emergency:"Emergencies (All)",zoom:11,show_red_circle:!1,show_blue_circle:!1,clicked_marker_id:"",play_sound:!1,channels_list:["lllaser"],agents_in_focus:[],laser_agents:[],monitoring_grid:[],responses_available:!1,route_responses_from_agents:[],action:"loading",action_message:"",tracked_area:"lllaser",date:new Date,message:"",selected_manual_call:"Emergency Management(LASEMA)",selected_manual_gender:"Male",manual_name:"",manual_phone:"",manual_address:"",showConfirmManualLocation:!1,isLoading:!1},a.pubnub=new ot.a({publishKey:"pub-c-100b3918-0e25-4fac-ade6-c58d013cd019",subscribeKey:"sub-c-21e1e450-9457-11e9-bf84-1623aee89087"}),a.pubnub.init(Object(c.a)(a)),a.closeSideBar=a.closeSideBar.bind(Object(c.a)(a)),a.onCallsChanged=a.onCallsChanged.bind(Object(c.a)(a)),a.onEmergenciesChanged=a.onEmergenciesChanged.bind(Object(c.a)(a)),a.onAgentClicked=a.onAgentClicked.bind(Object(c.a)(a)),a.onDateChange=a.onDateChange.bind(Object(c.a)(a)),a.onCalendarOpen=a.onCalendarOpen.bind(Object(c.a)(a)),a.latestClicked=a.latestClicked.bind(Object(c.a)(a)),a.startMonitoring=a.startMonitoring.bind(Object(c.a)(a)),a.closeAction=a.closeAction.bind(Object(c.a)(a)),a.closeAgentSideBar=a.closeAgentSideBar.bind(Object(c.a)(a)),a.addAgentToMonitoring=a.addAgentToMonitoring.bind(Object(c.a)(a)),a.getAgentIcon=a.getAgentIcon.bind(Object(c.a)(a)),a.getAgentsAroundEmergency=a.getAgentsAroundEmergency.bind(Object(c.a)(a)),a.handleSongFinishedPlaying=a.handleSongFinishedPlaying.bind(Object(c.a)(a)),a.removeAgentFromRoute=a.removeAgentFromRoute.bind(Object(c.a)(a)),a.closeRouteResponse=a.closeRouteResponse.bind(Object(c.a)(a)),a.removeAgentFromRouteAndCloseRouteResponse=a.removeAgentFromRouteAndCloseRouteResponse.bind(Object(c.a)(a)),a.showMonitoredEmergency=a.showMonitoredEmergency.bind(Object(c.a)(a)),a.getEmergencies=a.getEmergencies.bind(Object(c.a)(a)),a.getLocations=a.getLocations.bind(Object(c.a)(a)),a.getLocationsDate=a.getLocationsDate.bind(Object(c.a)(a)),a.getEmergenciesDate=a.getEmergenciesDate.bind(Object(c.a)(a)),a.getLatestEmergencies=a.getLatestEmergencies.bind(Object(c.a)(a)),a.getLatestLocations=a.getLatestLocations.bind(Object(c.a)(a)),a.getSelectedAgentsIds=a.getSelectedAgentsIds.bind(Object(c.a)(a)),a.setSelectedAgentsFromIds=a.setSelectedAgentsFromIds.bind(Object(c.a)(a)),a.resolveCall=a.resolveCall.bind(Object(c.a)(a)),a.resolveEmergency=a.resolveEmergency.bind(Object(c.a)(a)),a.hideConfirm=a.hideConfirm.bind(Object(c.a)(a)),a.showConfirmResolveEmergency=a.showConfirmResolveEmergency.bind(Object(c.a)(a)),a.showConfirmResolveLocation=a.showConfirmResolveLocation.bind(Object(c.a)(a)),a.getMonitoringGridFromServerAndReconcileAssignedAgents=a.getMonitoringGridFromServerAndReconcileAssignedAgents.bind(Object(c.a)(a)),a.setUpAssignedAgentsIfAny=a.setUpAssignedAgentsIfAny.bind(Object(c.a)(a)),a.removeAgentFromEmergencyAfterDecliningRequest=a.removeAgentFromEmergencyAfterDecliningRequest.bind(Object(c.a)(a)),a.onManualCallChanged=a.onManualCallChanged.bind(Object(c.a)(a)),a.onManualGenderChanged=a.onManualGenderChanged.bind(Object(c.a)(a)),a.onSubmitManualCallDetails=a.onSubmitManualCallDetails.bind(Object(c.a)(a)),a.openManualLocation=a.openManualLocation.bind(Object(c.a)(a)),a.onFieldChanged=a.onFieldChanged.bind(Object(c.a)(a)),a.showConfirmManualLocation=a.showConfirmManualLocation.bind(Object(c.a)(a)),a.hideConfirmManualLocation=a.hideConfirmManualLocation.bind(Object(c.a)(a)),a.tryAgainClicked=a.tryAgainClicked.bind(Object(c.a)(a)),a.continueConfirmAddressNotFoundClicked=a.continueConfirmAddressNotFoundClicked.bind(Object(c.a)(a)),a.closeConfirmAddressNotFoundClicked=a.closeConfirmAddressNotFoundClicked.bind(Object(c.a)(a)),a.saveManualLocation=a.saveManualLocation.bind(Object(c.a)(a)),a.showLoading=a.showLoading.bind(Object(c.a)(a)),a.hideLoading=a.hideLoading.bind(Object(c.a)(a)),a.logout=a.logout.bind(Object(c.a)(a));var s=xt.split(/T(.+)/)[0];s+="T00:00:00.000Z",Nt=new Date(s),dt.a.setApiKey("AIzaSyADNxHcgsHDyx_OSbqxBg5xB5lV2YJDcKI"),dt.a.setLanguage("en"),dt.a.setRegion("ngr"),dt.a.enableDebug(),a.utils=new ae;var r=new ce;return a.browserAdmin=r.getAdmin(),a}return Object(o.a)(n,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"logout",value:function(){this.props.logout()}},{key:"resolveEmergency",value:function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveCall",value:function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"showMonitoredEmergency",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.utils.getAdminEmergencyMonitored(this.browserAdmin._id,this.state.monitoring_grid);case 2:if(!(n=e.sent)||!n.emergency){e.next=14;break}a=n.emergency,e.t0=a.laser_type,e.next="emergency"===e.t0?8:"call"===e.t0?10:12;break;case 8:return this.setState({clicked_user:a,side_bar_open:!0,location_side_bar_open:!1,agent_side_bar_open:!1,center:{lat:a.latitude,lng:a.longitude},zoom:19,show_red_circle:!0,show_blue_circle:!1,clicked_marker_id:a._id}),e.abrupt("break",12);case 10:return this.setState({clicked_user:a,side_bar_open:!1,location_side_bar_open:!0,agent_side_bar_open:!1,center:{lat:a.latitude,lng:a.longitude},zoom:19,show_red_circle:!1,show_blue_circle:!0,clicked_marker_id:a._id}),e.abrupt("break",12);case 12:e.next=15;break;case 14:this.setState({action:"message",action_message:"You are not monitoring any emergency or call at the moment"});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"showConfirmResolveEmergency",value:function(e){e.preventDefault(),this.setState({showConfirm:{action:"emergency",status:!0},message:"Are you sure you want to mark this emergency issue as resolved ?"})}},{key:"showConfirmResolveLocation",value:function(){this.setState({showConfirm:{action:"location",status:!0},message:"Are you sure you want to mark this call as resolved ?"})}},{key:"removeAgentFromRoute",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){var a,s,r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,this.utils.removeAgentFromBrowserAdminMonitoringGrid(n,this.browserAdmin._id,this.state.monitoring_grid,this.state.laser_agents);case 3:if(!(a=e.sent)){e.next=11;break}return e.next=7,yt(a[0]);case 7:(s=e.sent)?("successful"===s.data&&(r=At.getAssignedAgents(),(i=this.utils.removeAgentFromListOfAssignedAgentsForPersistsnce(n,r)).length>0?At.saveAssignedAgents(i):At.deleteAssignedAgents(),this.pubnub.unsubscribe({channels:[n.agent._id]}),this.pubnub.publish({message:{pn_gcm:{data:{notification_body:"You need to abandon route. Tap to open app",data:{},action:"leave_route"}}},channel:n.agent._id,sendByPost:!1,storeInHistory:!1},(function(e,t){})),this.setState({action:"message",action_message:"Agent "+n.agent.firstname+" was successfully removed from monitoring the emergency",monitoring_grid:a[0],laser_agents:a[1],agent_side_bar_open:!1,clicked_agent:{}}),this.hideLoading()),"unsuccessful"===s.data&&(this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"}))):(this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"})),e.next=13;break;case 11:this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"});case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeAgentFromRouteAndCloseRouteResponse",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){var a,s,r,i,l,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.agent,this.showLoading(),e.next=4,this.utils.removeAgentFromBrowserAdminMonitoringGrid(a,this.browserAdmin._id,this.state.monitoring_grid,this.state.laser_agents);case 4:if(!(s=e.sent)){e.next=12;break}return e.next=8,yt(s[0]);case 8:(r=e.sent)?("successful"===r.data&&(i=At.getAssignedAgents(),(l=this.utils.removeAgentFromListOfAssignedAgentsForPersistsnce(a,i)).length>0?At.saveAssignedAgents(l):At.deleteAssignedAgents(),this.pubnub.unsubscribe({channels:[a.agent._id]}),(o=this.state.route_responses_from_agents).splice(o.indexOf(n),1),At.saveCompletedEmergenciesResponse(o),this.setState({action:"message",action_message:"Agent "+a.agent.firstname+" was successfully removed from monitoring the emergency",monitoring_grid:s[0],laser_agents:s[1],agent_side_bar_open:!1,clicked_agent:{},route_responses_from_agents:o}),this.hideLoading()),"unsuccessful"===r.data&&(this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"}))):(this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"})),e.next=14;break;case 12:this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"});case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addAgentToMonitoring",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){var a,s,r,i,l,o,c,d,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.utils.checkIfEmergencyMonitoredByBrowserAdmin(this.browserAdmin._id,this.state.monitoring_grid)){e.next=26;break}return e.next=4,this.utils.checkIfOtherAdminIsUsingAgent(this.browserAdmin._id,n,this.state.monitoring_grid);case 4:if(!e.sent){e.next=9;break}this.setState({action:"message",action_message:"Another admin has assigned agent "+n.agent.firstname+" to an emergency"}),e.next=24;break;case 9:return e.next=11,this.utils.setAgentOnMonitoringGridAndChangeAgentStatus(n,this.state.monitoring_grid,this.browserAdmin._id,this.state.laser_agents);case 11:return a=e.sent,s=a[0],r=a[1],e.next=16,yt(s);case 16:if("successful"!==(i=e.sent).data){e.next=23;break}return e.next=20,this.utils.getAdminEmergencyMonitored(this.browserAdmin._id,this.state.monitoring_grid);case 20:l=e.sent,(o=l.emergency)&&(this.pubnub.publish({message:{pn_gcm:{data:{notification_body:"You have a new route. Tap to open app.",data:o.phone_number?{full_name:o.full_name,_id:o.user,phone_number:o.phone_number,latitude:o.latitude,longitude:o.longitude}:{full_name:o.full_name,_id:o.user,latitude:o.latitude,longitude:o.longitude},action:"route_request"}}},channel:n.agent._id,sendByPost:!1,storeInHistory:!1},(function(e,t){})),-1===(c=this.state.channels_list).indexOf(n.agent._id)&&c.push(n.agent._id),this.pubnub.subscribe({channels:c}),d=At.getAssignedAgents(),u=this.utils.addAgentToListOfAssignedAgentsForPersistence(n,d),At.saveAssignedAgents(u),this.setState({monitoring_grid:s,laser_agents:r,action:"message",action_message:"Agent "+n.agent.firstname+" has been successfully assigned to the emergency"}));case 23:"unsuccessful"===i.data&&this.setState({action:"message",action_message:"The system could NOT successfully assign the agent to the emergency"});case 24:e.next=26;break;case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"startMonitoring",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){var a,s,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.utils.checkIfEmergencyMonitoredByOtherAdmin(this.state.monitoring_grid,n,this.browserAdmin._id);case 3:if(!e.sent){e.next=8;break}this.setState({action:"message",action_message:"Another admin is already monitoring the selected emergency"}),e.next=16;break;case 8:return e.next=10,this.utils.setEmergencyOnMonitoringGrid(n,this.state.monitoring_grid,this.browserAdmin._id);case 10:return a=e.sent,e.next=13,yt(a);case 13:"successful"===(s=e.sent).data&&(r=this.state.channels_list,n.is_trackable&&(-1===r.indexOf(n.user)&&r.push(n.user),this.pubnub.subscribe({channels:r})),this.setState({action:"message",action_message:"You are now monitoring "+n.full_name,channels_list:r,monitoring_grid:a})),"unsuccessful"===s.data&&this.setState({action:"message",action_message:"The system could not initiate the monitoring of that emergency"});case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),this.setState({action:"message",action_message:"Error occurred initiating monitoring of emergency"});case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAgentsAroundEmergency",value:function(){var e=this;this.utils.checkIfEmergencyMonitoredByBrowserAdmin(this.browserAdmin._id,this.state.monitoring_grid).then((function(t){t?(e.pubnub.publish({message:{pn_gcm:{data:{notification_body:"Tap to open the Laser App",data:{},action:"send_location"}}},channel:e.state.tracked_area,sendByPost:!1,storeInHistory:!1},(function(e,t){})),e.utils.getAdminEmergencyMonitored(e.browserAdmin._id,e.state.monitoring_grid).then((function(t){e.utils.setAgentsInFocus(e.state.agents_in_focus,t.emergency,e.state.laser_agents).then((function(t){e.setState({laser_agents:t[0],agents_in_focus:t[1]})})).catch((function(t){e.setState({action:"message",action_message:"An error occurred seeking agents around emergency"})}))})).catch((function(e){}))):e.setState({action:"message",action_message:"You are NOT monitoring any emergency or call"})})).catch((function(t){e.setState({action:"message",action_message:"An error occurred seeking agents around emergency"})}))}},{key:"latestClicked",value:function(e){switch(e.laser_type){case"emergency":this.setState({clicked_user:e,side_bar_open:!0,location_side_bar_open:!1,agent_side_bar_open:!1,center:{lat:e.latitude,lng:e.longitude},zoom:19,show_red_circle:!0,show_blue_circle:!1,clicked_marker_id:e._id});break;case"call":this.setState({clicked_user:e,side_bar_open:!1,location_side_bar_open:!0,agent_side_bar_open:!1,center:{lat:e.latitude,lng:e.longitude},zoom:19,show_red_circle:!1,show_blue_circle:!0,clicked_marker_id:e._id})}}},{key:"openManualLocation",value:function(){this.setState({manual_location_side_bar:!0,side_bar_open:!1,location_side_bar_open:!1,agent_side_bar_open:!1})}},{key:"onCalendarOpen",value:function(){this.setState({play_sound:!1,side_bar_open:!1,location_side_bar_open:!1,agent_side_bar_open:!1})}},{key:"onDateChange",value:function(e){(e=new Date(e)).setHours(e.getHours()+1),this.setState({play_sound:!1,date:e,show_red_circle:!1,show_blue_circle:!1,clicked_marker_id:"",action:"loading",action_message:"",selected_call:"Calls (All)",selected_emergency:"Emergencies (All)"}),this.getLocationsDate(e),this.getEmergenciesDate(e)}},{key:"onCallsChanged",value:function(e){var t=e.target,n=t.value,a=(t.name,[]);this.state.locations.length>0?"Calls (All)"===n?this.setState((function(e){return{play_sound:!1,filtered_locations:e.locations,side_bar_open:!1,selected_call:n,agent_side_bar_open:!1,location_side_bar_open:!1,show_blue_circle:!1}})):"None"===n?this.setState({play_sound:!1,filtered_locations:[],side_bar_open:!1,selected_call:n,agent_side_bar_open:!1,location_side_bar_open:!1,show_blue_circle:!1}):(this.state.locations.map((function(e){e.reason.includes(n.toLowerCase())&&a.push(e)})),a.length>0?this.setState({play_sound:!1,filtered_locations:a,selected_call:n,side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!1,show_blue_circle:!1}):this.setState({play_sound:!1,filtered_locations:[],selected_call:n,side_bar_open:!1,location_side_bar_open:!1,show_blue_circle:!1})):this.setState({selected_call:n})}},{key:"onEmergenciesChanged",value:function(e){var t=e.target,n=t.value,a=(t.name,[]);this.state.emergencies.length>0?"Emergencies (All)"===n?this.setState((function(e){return{play_sound:!1,filtered_emergencies:e.emergencies,side_bar_open:!1,selected_emergency:n,location_side_bar_open:!1,agent_side_bar_open:!1,show_red_circle:!1}})):"None"===n?this.setState({play_sound:!1,filtered_emergencies:[],selected_emergency:n,side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!1,show_red_circle:!1}):(this.state.emergencies.map((function(e){e.reasons&&e.reasons.length>0&&e.reasons.map((function(t){n.toLowerCase().includes(t)&&a.push(e)}))})),a.length>0?this.setState({play_sound:!1,filtered_emergencies:a,selected_emergency:n,side_bar_open:!1,agent_side_bar_open:!1,location_side_bar_open:!1,show_red_circle:!1}):this.setState({play_sound:!1,filtered_emergencies:[],side_bar_open:!1,selected_emergency:n,agent_side_bar_open:!1,location_side_bar_open:!1,show_red_circle:!1})):this.setState({selected_emergency:n})}},{key:"onCallClicked",value:function(e,t){this.setState({play_sound:!1,clicked_user:e,clicked_agent:{},side_bar_open:!1,agent_side_bar_open:!1,manual_location_side_bar:!1,location_side_bar_open:!0,center:{lat:e.latitude,lng:e.longitude},zoom:19,show_red_circle:!1,show_blue_circle:!0,clicked_marker_id:e._id})}},{key:"onEmergencyClicked",value:function(e,t){this.setState({play_sound:!1,clicked_user:e,clicked_agent:{},side_bar_open:!0,manual_location_side_bar:!1,agent_side_bar_open:!1,location_side_bar_open:!1,center:{lat:e.latitude,lng:e.longitude},zoom:19,show_red_circle:!0,show_blue_circle:!1,clicked_marker_id:e._id})}},{key:"onAgentClicked",value:function(e,t){this.setState({play_sound:!1,clicked_agent:e,manual_location_side_bar:!1,agent_side_bar_open:!0})}},{key:"getLocationsMarkers",value:function(){var e=this;return this.state.filtered_locations.length>0?this.state.filtered_locations.map((function(t){return s.a.createElement(Q.Marker,{key:t._id,onClick:function(n){return e.onCallClicked(t,n)},name:t.reason,title:t.full_name,position:{lat:t.latitude,lng:t.longitude},icon:{url:e.state.clicked_marker_id===t._id?y.a:C.a}})})):""}},{key:"getEmergenciesMarkers",value:function(){var e=this;return this.state.filtered_emergencies.length>0?this.state.filtered_emergencies.map((function(t){return s.a.createElement(Q.Marker,{key:t._id,onClick:function(n){return e.onEmergencyClicked(t,n)},name:t.reasons[0],title:t.full_name,position:{lat:t.latitude,lng:t.longitude},icon:{url:e.state.clicked_marker_id===t._id?v.a:w.a}})})):""}},{key:"getAgentMarkers",value:function(){var e=this;return this.state.laser_agents.length>0?this.state.laser_agents.map((function(t,n){return s.a.createElement(Q.Marker,{key:n,onClick:function(n){return e.onAgentClicked(t,n)},name:t.full_address,title:t.full_address,position:{lat:t.latitude,lng:t.longitude},icon:{url:e.getAgentIcon(t),anchor:new e.props.google.maps.Point(40,40),scaledSize:new e.props.google.maps.Size(40,40)}})})):""}},{key:"getAgentIcon",value:function(e){if(e)switch(e.agent.department){case"police":switch(e.status){case"idle":return N.a;case"infocus":return D.a;case"using":return L.a;case"using_by_other":return M.a}break;case"fire":switch(e.status){case"idle":return P.a;case"infocus":return q.a;case"using":return I.a;case"using_by_other":return G.a}break;case"hospital":switch(e.status){case"idle":return U.a;case"infocus":return K.a;case"using":return H.a;case"using_by_other":return J.a}}}},{key:"hideConfirm",value:function(){this.setState({showConfirm:{action:"",status:!1},message:""})}},{key:"closeAction",value:function(e){this.setState({action:"close",action_message:""})}},{key:"closeSideBar",value:function(e){this.setState({play_sound:!1,side_bar_open:!1,location_side_bar_open:!1,manual_location_side_bar:!1,agent_side_bar_open:!1,selected_location:{},selected_emergency:{},clicked_marker_id:""})}},{key:"closeAgentSideBar",value:function(e){this.setState({clicked_agent:{},agent_side_bar_open:!1})}},{key:"closeRouteResponse",value:function(e){this.setState((function(t){var n=t.route_responses_from_agents;return n.splice(n.indexOf(e),1),{route_responses_from_agents:n}}))}},{key:"getSelectedAgentsIds",value:function(){}},{key:"setSelectedAgentsFromIds",value:function(e){}},{key:"getMonitoringGridFromServerAndReconcileAssignedAgents",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t,n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,kt();case 3:(t=e.sent)?(this.setUpAssignedAgentsIfAny(t.data),this.utils.getAdminEmergencyMonitored(this.browserAdmin._id,t.data).then((function(e){var a=e.emergency;if(a)if(-1===n.state.channels_list.indexOf(a.user)){var s=n.state.channels_list.concat([a.user]);n.pubnub.subscribe({channels:s}),n.setState({action:"message",action_message:"You are monitoring "+a.full_name,monitoring_grid:t.data,channels_list:s}),n.hideLoading()}else n.pubnub.subscribe({channels:n.state.channels_list}),n.setState({action:"message",action_message:"You are monitoring "+a.full_name,monitoring_grid:t.data}),n.hideLoading();else n.setState({monitoring_grid:t.data}),n.hideLoading()})).catch((function(e){n.setState({monitoring_grid:t.data}),n.hideLoading()}))):(this.setState({action:"message",action_message:"An error occurred. Please check the network."}),this.hideLoading());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setUpAssignedAgentsIfAny",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n,a,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=At.getAssignedAgents())&&n.length>0)){e.next=6;break}return e.next=4,this.utils.reconcileAssignedAgentsListWithMonitoringGrid(this.browserAdmin._id,n,t);case 4:(a=e.sent)[0].length>0?(At.saveAssignedAgents(a[0]),s=this.state.channels_list.concat(a[0]),this.pubnub.subscribe({channels:s}),this.setState({laser_agents:a[1],channels_list:s})):(At.deleteAssignedAgents(),this.setState({laser_agents:a[1]}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.pubnub.unsubscribe({channels:this.state.channels_list})}},{key:"componentDidMount",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t,n,a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.pubnub.subscribe({channels:this.state.channels_list}),this.setState({laser_agents:[]}),this.getMonitoringGridFromServerAndReconcileAssignedAgents(),(t=At.getCompletedEmergenciesResponse())&&t.length>0&&this.setState({route_responses_from_agents:t}),this.pubnub.addListener({status:function(e){"PNNetworkUpCategory"===e.category&&(a.setState({action:"message",action_message:"You are back online."}),a.getMonitoringGridFromServerAndReconcileAssignedAgents()),e.category,"PNReconnectedCategory"===e.category&&(a.setState({action:"message",action_message:"You are back online."}),a.getMonitoringGridFromServerAndReconcileAssignedAgents()),"PNNetworkIssuesCategory"===e.category&&a.setState({action:"message",action_message:"It appears there is a network issue."}),"PNNetworkDownCategory"===e.category&&a.setState({action:"message",action_message:"It appears the network is down."}),"PNTimeoutCategory"===e.category&&a.setState({action:"message",action_message:"Could not connect to the internet."})},message:function(e){if(a.utils.getAdminEmergencyMonitored(a.browserAdmin._id,a.state.monitoring_grid).then((function(t){var n=t.emergency;if(e.channel===n._id&&e.userMetadata&&"user_location_update"===e.userMetadata.action){var s=a.state.emergencies.map((function(t){return t.user===n.user?(t.latitude=e.message.latitude,t.longitude=e.message.longitude,t):t}));a.setState((function(e){return{emergencies:s}}))}})).catch((function(e){})),e.channel===a.state.tracked_area&&e.userMetadata&&"agent_location_update"===e.userMetadata.action&&a.utils.updateAgentLocation(e.message,a.state.laser_agents,a.state.monitoring_grid,a.browserAdmin._id).then((function(e){a.setState((function(t){return{laser_agents:e}}))})).catch((function(e){})),e.userMetadata&&"route_request_response"===e.userMetadata.action){var t=e.message;if(e.channel===t._id){a.showLoading();var n=At.getAssignedAgents();a.utils.getAgentFromAssignedAgentsInPersistence(n,t._id).then((function(e){a.removeAgentFromEmergencyAfterDecliningRequest(e)})).catch((function(e){a.hideLoading(),a.setState({action:"message",action_message:"Agent "+t.firstname+" declined to attend to emergency but an error occurred updating the system. Please manually remove the agent from emergency"})}))}}if(e.userMetadata&&"route_completed"===e.userMetadata.action){var s=At.getCompletedEmergenciesResponse();a.utils.getAdminEmergencyMonitored(a.browserAdmin._id,a.state.monitoring_grid).then((function(t){var n=At.getAssignedAgents();a.utils.getAgentFromAssignedAgentsInPersistence(n,e.message._id).then((function(e){s&&s.length>0?s.push({agent:e,user:t.emergency}):s=[{agent:e,user:t.emergency}],At.saveCompletedEmergenciesResponse(s),a.setState({route_responses_from_agents:s})})).catch((function(e){}))})).catch((function(e){}))}}}),(n=ee()("http://3.121.181.120")).on("connect",(function(){return console.log("connected to socket io")})),n.on("reconnect",(function(e){console.log("Socket IO Reconnected")})),n.on("emergency",(function(e){e&&a.setState((function(t){var n=t.emergencies,a=t.latest;return a.push(e),n.push(e),{play_sound:!0,latest:a,clicked_marker_id:e._id,zoom:18,emergencies:n,center:{lat:e.latitude,lng:e.longitude}}}))})),n.on("call",(function(e){e&&a.setState((function(t){var n=t.locations,a=t.latest;return a.push(e),n.push(e),{play_sound:!0,latest:a,clicked_marker_id:e._id,zoom:18,locations:n,center:{lat:e.latitude,lng:e.longitude}}}))})),n.on("monitoring_update",(function(e){if(e!==a.browserAdmin._id){a.showLoading();var t=[];kt().then((function(e){t=e.data,a.utils.reconcileAllAgentsWithMonitoringGrid(a.state.laser_agents,e.data,a.browserAdmin._id).then((function(e){a.setState({monitoring_grid:t,laser_agents:e}),a.hideLoading()})).catch((function(e){a.setState({monitoring_grid:t}),a.hideLoading()}))})).catch((function(e){a.setState({monitoring_grid:t}),a.hideLoading()}))}})),this.getLocations(),this.getEmergencies();case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeAgentFromEmergencyAfterDecliningRequest",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n,a,s,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,this.utils.removeAgentFromBrowserAdminMonitoringGrid(t,this.browserAdmin._id,this.state.monitoring_grid,this.state.laser_agents);case 3:if(!(n=e.sent)){e.next=11;break}return e.next=7,yt(n[0]);case 7:(a=e.sent)?("successful"===a.data&&(s=At.getAssignedAgents(),(r=this.utils.removeAgentFromListOfAssignedAgentsForPersistsnce(t,s)).length>0?At.saveAssignedAgents(r):At.deleteAssignedAgents(),this.pubnub.unsubscribe({channels:[t.agent._id]}),this.setState({action:"message",action_message:"Agent "+t.agent.firstname+" declined the request to attend to the emergency",monitoring_grid:n[0],laser_agents:n[1],agent_side_bar_open:!1,clicked_agent:{}}),this.hideLoading()),"unsuccessful"===a.data&&(this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"}))):(this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"})),e.next=13;break;case 11:this.hideLoading(),this.setState({action:"message",action_message:"An error occurred removing the agent from the emergency"});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLocationsDate",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bt({date:t});case 2:if("error"!=(n=e.sent)){e.next=6;break}return this.setState({action:"err_calls_load",locations:[],filtered_locations:[]}),e.abrupt("return");case 6:n&&n.data&&n.data.locations?"loading"===this.state.action?this.setState({action:"close",locations:n.data.locations,filtered_locations:n.data.locations}):this.setState({locations:n.data.locations,filtered_locations:n.data.locations}):this.setState({action:"close",locations:[],filtered_locations:[]});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEmergenciesDate",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ft({date:t});case 2:if("error"!=(n=e.sent)){e.next=6;break}return this.setState({action:"err_emergency_load",emergencies:[],filtered_emergencies:[]}),e.abrupt("return");case 6:n&&n.data&&n.data.emergencies?"loading"===this.state.action?this.setState({action:"close",emergencies:n.data.emergencies,filtered_emergencies:n.data.emergencies}):this.setState({emergencies:n.data.emergencies,filtered_emergencies:n.data.emergencies}):this.setState({action:"close",emergencies:[],filtered_emergencies:[]});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLatestLocations",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,bt({date:Nt});case 3:if("error"!=(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:n&&n.data&&n.data.locations&&n.data.locations.length>0&&t.setState((function(e){for(var t=e.latest,a=0;a<n.data.locations.length;a++)t.push(n.data.locations[a]);return{latest:t=wt.sortDates(t)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLatestEmergencies",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,ft({date:Nt});case 3:if("error"!=(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:n&&n.data&&n.data.emergencies&&n.data.emergencies.length>0&&t.setState((function(e){for(var t=e.latest,a=0;a<n.data.emergencies.length;a++)t.push(n.data.emergencies[a]);return{latest:t=wt.sortDates(t)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getEmergencies",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t,n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ft({date:Nt});case 2:if("error"!=(t=e.sent)){e.next=6;break}return this.setState({action:"err_emergency_load",emergencies:[],filtered_emergencies:[]}),e.abrupt("return");case 6:t&&t.data&&t.data.emergencies&&t.data.emergencies.length>0?this.setState((function(e){for(var a=e.latest,s=0;s<t.data.emergencies.length;s++)a.push(t.data.emergencies[s]);return a=wt.sortDates(a),"loading"===n.state.action?{action:"close",latest:a,emergencies:t.data.emergencies,filtered_emergencies:t.data.emergencies}:{latest:a,emergencies:t.data.emergencies,filtered_emergencies:t.data.emergencies}})):this.setState({action:"close",emergencies:[],filtered_emergencies:[]});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLocations",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t,n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bt({date:Nt});case 2:if("error"!=(t=e.sent)){e.next=6;break}return this.setState({action:"err_calls_load",locations:[],filtered_locations:[]}),e.abrupt("return");case 6:t&&t.data&&t.data.locations&&t.data.locations.length>0?this.setState((function(e){for(var a=e.latest,s=0;s<t.data.locations.length;s++)a.push(t.data.locations[s]);return a=wt.sortDates(a),"loading"===n.state.action?{action:"close",latest:a,locations:t.data.locations,filtered_locations:t.data.locations}:{latest:a,locations:t.data.locations,filtered_locations:t.data.locations}})):this.setState({action:"close",locations:[],filtered_locations:[]});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleSongFinishedPlaying",value:function(){this.setState({play_sound:!1})}},{key:"onFieldChanged",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,a=t.name;this.setState(Object(h.a)({},a,n))}},{key:"onManualCallChanged",value:function(e){var t=e.target.value;this.setState({selected_manual_call:t})}},{key:"onManualGenderChanged",value:function(e){var t=e.target.value;this.setState({selected_manual_gender:t})}},{key:"onSubmitManualCallDetails",value:function(e){var t=this;e.preventDefault(),this.state.selected_manual_call.length<=0?this.setState({action:"message",action_message:"Please enter a valid reason for call from the drop down"}):this.state.manual_phone.lenght<=0?this.setState({action:"message",action_message:"Please enter a valid phone number"}):this.state.selected_manual_gender.length<=0?this.setState({action:"message",action_message:"Please enter a valid gender"}):this.state.manual_name.length<=0?this.setState({action:"message",action_message:"Please enter a valid name"}):this.state.manual_address.length<=0?this.setState({action:"message",action_message:"Please enter an address"}):(this.setState({action:"loading",action_message:""}),dt.a.fromAddress(this.state.manual_address).then((function(e){var n=e.results[0].geometry.location,a=n.lat,s=n.lng,r={action:t.state.selected_manual_call,longitude:s,latitude:a,full_address:t.state.manual_address,full_name:t.state.manual_name,phone_number:t.state.manual_phone};t.saveManualLocation(r)}),(function(e){console.error(e),t.setState({action:"message",action_message:"We could not find that address",showConfirmManualLocation:!0})})))}},{key:"showConfirmManualLocation",value:function(){this.setState({showConfirmManualLocation:!0})}},{key:"hideConfirmManualLocation",value:function(){this.setState({showConfirmManualLocation:!1})}},{key:"tryAgainClicked",value:function(){var e=this;this.hideConfirmManualLocation(),this.setState({action:"loading",action_message:""}),dt.a.fromAddress(this.state.manual_address).then((function(t){var n=t.results[0].geometry.location,a=n.lat,s=n.lng,r={action:e.state.selected_manual_call,longitude:s,latitude:a,full_address:e.state.manual_address,full_name:e.state.manual_name,phone_number:e.state.manual_phone};e.saveManualLocation(r)}),(function(t){console.error(t),e.setState({action:"message",action_message:"We could not find that address"})}))}},{key:"continueConfirmAddressNotFoundClicked",value:function(){this.hideConfirmManualLocation()}},{key:"closeConfirmAddressNotFoundClicked",value:function(){this.setState({action:"message",action_message:""}),this.hideConfirmManualLocation()}},{key:"saveManualLocation",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt("/create_manual_location",t).then((function(e){return e})).catch((function(e){return console.log({err:e}),"error"}));case 2:if("error"!=(n=e.sent)){e.next=6;break}return this.setState({action:"message",action_message:"An error occurred saving the location. Please try again"}),e.abrupt("return");case 6:if(!n||!n.data){e.next=11;break}if("out_of_lagos"!==n.data.response){e.next=10;break}return this.setState({action:"message",action_message:"That location is outside Lagos State"}),e.abrupt("return");case 10:this.setState({action:"message",action_message:"The location has been saved and is displayed on the map",selected_manual_call:"Emergency Management(LASEMA)",selected_manual_gender:"Male",manual_name:"",manual_phone:"",manual_address:"",manual_location_side_bar:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n;return e=this.state.play_sound?s.a.createElement(it.a,{url:$.a,playStatus:it.a.status.PLAYING,playFromPosition:1,onLoading:this.handleSongLoading,onPlaying:this.handleSongPlaying,onFinishedPlaying:this.handleSongFinishedPlaying}):"",t=this.state.location_side_bar_open?s.a.createElement(ke,{closeSidebar:this.closeSideBar,startMonitoring:this.startMonitoring,location:this.state.clicked_user,resolve:this.showConfirmResolveLocation}):"",n=this.state.side_bar_open?s.a.createElement(me,{closeSidebar:this.closeSideBar,emergency:this.state.clicked_user,startMonitoring:this.startMonitoring,resolve:this.showConfirmResolveEmergency}):"",s.a.createElement("div",{className:"laser-parent-div",style:Ct},s.a.createElement($e,{latest:this.state.latest,latestClicked:this.latestClicked}),t,n,this.state.showConfirmManualLocation?s.a.createElement(Le,{closeConfirmAddressNotFoundClicked:this.continueConfirmAddressNotFoundClicked,tryAgainClicked:this.continueConfirmAddressNotFoundClicked,hideConfirmManualLocation:this.hideConfirmManualLocation}):"",this.state.manual_location_side_bar?s.a.createElement(Ae,{onFieldChanged:this.onFieldChanged,closeSidebar:this.closeSideBar,selected_manual_call:this.state.selected_manual_call,selected_manual_gender:this.state.selected_manual_gender,manual_address:this.state.manual_address,manual_name:this.state.manual_name,onManualCallChanged:this.onManualCallChanged,onManualGenderChanged:this.onManualGenderChanged,onSubmitManualCallDetails:this.onSubmitManualCallDetails}):"",this.state.agent_side_bar_open?s.a.createElement(ve,{removeAgentFromRoute:this.removeAgentFromRoute,closeAgentSideBar:this.closeAgentSideBar,addAgentToMonitoring:this.addAgentToMonitoring,agent:this.state.clicked_agent,user:this.state.clicked_user}):"",s.a.createElement(Ue,{showMonitoredEmergency:this.showMonitoredEmergency,openManualLocation:this.openManualLocation,logout:this.logout,onCalendarOpen:this.onCalendarOpen,onDateChange:this.onDateChange,date:this.state.date,selected_call:this.state.selected_call,onCallsChanged:this.onCallsChanged,selected_emergency:this.state.selected_emergency,onEmergenciesChanged:this.onEmergenciesChanged,getAgentsAroundEmergency:this.getAgentsAroundEmergency}),s.a.createElement(Q.Map,{google:this.props.google,style:Ct,onReady:this.fetchPlaces,initialCenter:this.state.center,center:this.state.center,zoom:this.state.zoom},this.getLocationsMarkers(),this.getEmergenciesMarkers(),this.getAgentMarkers()),s.a.createElement(ht,{isLoading:this.state.isLoading}),s.a.createElement(pe,{action:this.state.action,closeAction:this.closeAction,message:this.state.action_message}),s.a.createElement(ht,{isLoading:this.state.isLoading}),e,this.state.route_responses_from_agents.length>0?s.a.createElement(et,{route_response:this.state.route_responses_from_agents[this.state.route_responses_from_agents.length-1],removeAgentFromRouteAndCloseRouteResponse:this.removeAgentFromRouteAndCloseRouteResponse,closeRouteResponse:this.closeRouteResponse}):"",!0===this.state.showConfirm.status?s.a.createElement(at,{yesClicked:"emergency"===this.state.showConfirm.action?this.resolveEmergency:this.resolveCall,noClicked:this.hideConfirm,message:this.state.message}):"")}}]),n}(a.Component),Lt=Object(Q.GoogleApiWrapper)({apiKey:"AIzaSyADNxHcgsHDyx_OSbqxBg5xB5lV2YJDcKI"})(St),Ot=new ae,Mt={marginLeft:"8px"};function jt(e){return s.a.createElement("div",{className:"col-md-4 col-sm-4"},s.a.createElement("div",{className:"laser-item shadow"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-7 col-sm-7"},s.a.createElement("h4",null,e.agent.firstname," ",e.agent.lastname),s.a.createElement("h5",null,Ot.getDate(e.agent.created))),s.a.createElement("div",{className:"col-md-5 col-sm-5"},s.a.createElement("h5",null,e.agent.phone_number),s.a.createElement("h4",null,e.agent.department," department")),s.a.createElement("div",{className:"col-md-offset-6 col-md-6 col-sm-offset-6 col-sm-6"},s.a.createElement("button",{onClick:function(t){return e.deleteClicked(t,e.agent)},className:"laserbtn laser-red-bg laser-inline"},"delete"),s.a.createElement("button",{style:Mt,onClick:function(t){return e.editClicked(t,e.agent)},className:"laserbtn laser-blue-bg laser-inline"},"edit")))))}xe.a.setAppElement("#main");var Dt={marginRight:"8px"},Ft={marginLeft:"8px",marginRight:"16px"},Pt={marginRight:"8px"},Rt=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={firstname:"",lastname:"",phone_number:"",department:"",password:"",password_again:"",error:"",isLoading:!1},a.submitClicked=a.submitClicked.bind(Object(c.a)(a)),a.onFieldChanged=a.onFieldChanged.bind(Object(c.a)(a)),a.showLoading=a.showLoading.bind(Object(c.a)(a)),a.hideLoading=a.hideLoading.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"submitClicked",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),this.setState({error:""}),!(this.state.firstname.length<=0||this.state.lastname.length<=0)){e.next=5;break}return this.setState({error:"Please enter a valid first and last name"}),e.abrupt("return");case 5:if(!(this.state.phone_number.length<11)){e.next=8;break}return this.setState({error:"Please enter a valid phone number"}),e.abrupt("return");case 8:if(!(this.state.department.length<0)){e.next=11;break}return this.setState({error:"Please enter a valid department"}),e.abrupt("return");case 11:if(!(this.state.password.length<8||this.state.password_again.length<8)){e.next=14;break}return this.setState({error:"Please enter a valid password with 8 characters or more"}),e.abrupt("return");case 14:if(this.state.password===this.state.password_again){e.next=17;break}return this.setState({error:"Passwords dont match"}),e.abrupt("return");case 17:return n={firstname:this.state.firstname,lastname:this.state.lastname,phone_number:this.state.phone_number,department:this.state.department,password:this.state.password,password_again:this.state.password_again},this.showLoading(),e.next=21,_t(n);case 21:if("error"!=(a=e.sent)){e.next=25;break}return this.setState({action:"message",action_message:"An error occurred creating agent, Please try again later"}),e.abrupt("return");case 25:a&&a.data?(this.hideLoading(),this.props.closeModalGetAgents()):this.setState({action:"close"});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;this.props.departments.length>0&&this.setState((function(t){return{department:e.props.departments[0]}}))}},{key:"onFieldChanged",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,a=t.name;this.setState(Object(h.a)({},a,n))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(xe.a,{isOpen:!0,className:"Modal",overlayClassName:"Overlay",contentLabel:"Minimal Modal Example"},s.a.createElement("h4",{className:"text-center blue-text"},"Add Agent"),s.a.createElement("br",null),s.a.createElement("h5",{className:"laser-red-text"},this.state.error?this.state.error:""),s.a.createElement("br",null),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"First Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"firstname",type:"text",name:"firstname",onChange:this.onFieldChanged,value:this.state.firstname,className:"form-control bt-login-input",placeholder:"First Name"})),s.a.createElement("div",{className:"col-md-6"},s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Last Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"lastname",type:"text",name:"lastname",onChange:this.onFieldChanged,value:this.state.lastname,className:"form-control bt-login-input",placeholder:"Last Name"}))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("br",null),s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Phone Number")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"phone_number",type:"phone",name:"phone_number",onChange:this.onFieldChanged,value:this.state.phone_number,className:"form-control bt-login-input",placeholder:"Phone Number"})),s.a.createElement("div",{className:"col-md-6"},s.a.createElement("br",null),s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Department")),s.a.createElement("select",{style:Pt,className:"form-control",id:"department",name:"department",value:this.state.department,onChange:this.onFieldChanged},this.props.departments.map((function(e){return s.a.createElement("option",null,e)}))))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("br",null),s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Password")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"password",type:"password",name:"password",onChange:this.onFieldChanged,value:this.state.password,className:"form-control bt-login-input",placeholder:"Password"})),s.a.createElement("div",{className:"col-md-6"},s.a.createElement("br",null),s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Password Again")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"password_again",type:"password",name:"password_again",onChange:this.onFieldChanged,value:this.state.password_again,className:"form-control bt-login-input",placeholder:"Password Again"}))),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-inline laser-blue-bg laserbtn",style:Dt,onClick:function(t){return e.submitClicked(t)}},"create"),s.a.createElement("button",{className:"laser-inline grey-bg laserbtn laser-black-text",style:Ft,onClick:this.props.closeModal},"cancel")),s.a.createElement(ht,{isLoading:this.state.isLoading}))}}]),n}(a.Component),It=(n(298),{marginLeft:"8px",marginRight:"8px"}),Tt=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={agents:[],departments:[],agents_filter:[],selected_department:"",selected_agent:{},showConfirm:!1,showAddAgent:!1,showDeleteAgent:!1,showEditAgent:!1,confirmMessage:"",isLoading:!1},a.getAgents=a.getAgents.bind(Object(c.a)(a)),a.getAgentsDepartment=a.getAgentsDepartment.bind(Object(c.a)(a)),a.getDepartments=a.getDepartments.bind(Object(c.a)(a)),a.deleteAgent=a.deleteAgent.bind(Object(c.a)(a)),a.closeModal=a.closeModal.bind(Object(c.a)(a)),a.closeModalGetAgents=a.closeModalGetAgents.bind(Object(c.a)(a)),a.showDeleteAgent=a.showDeleteAgent.bind(Object(c.a)(a)),a.showAddAgent=a.showAddAgent.bind(Object(c.a)(a)),a.showEditAgent=a.showEditAgent.bind(Object(c.a)(a)),a.onDepartmentChanged=a.onDepartmentChanged.bind(Object(c.a)(a)),a.showLoading=a.showLoading.bind(Object(c.a)(a)),a.hideLoading=a.hideLoading.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"getAgents",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,pt("/get_agents").then((function(e){return e})).catch((function(e){return console.log({err:e}),"error"}));case 3:if(t=e.sent,this.hideLoading(),"error"!==t){e.next=7;break}return e.abrupt("return");case 7:t&&t.data&&t.data.length>0&&this.setState({agents:t.data});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAgentsDepartment",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,pt("/get_agents_departments",{department:t}).then((function(e){return e})).catch((function(e){return console.log({err:e}),"error"}));case 3:if(n=e.sent,this.hideLoading(),"error"!==n){e.next=7;break}return e.abrupt("return");case 7:n&&n.data&&n.data.length>0&&this.setState({agents:n.data});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDepartments",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,vt();case 3:if(t=e.sent,this.hideLoading(),"error"!==t){e.next=7;break}return e.abrupt("return");case 7:t&&t.data&&t.data.length>0&&this.setState((function(e){var n=["All"];return t.data.map((function(e){n.push(e.name)})),{departments:n}}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteAgent",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,t=this.state.selected_agent._id,pt("/delete_agent",{id:t}).then((function(e){return e})).catch((function(e){return console.log(e),"error"}));case 3:if(n=e.sent,this.hideLoading(),"error"!==n){e.next=7;break}return e.abrupt("return");case 7:n&&n.data&&(this.closeModal(),this.setState((function(e){var t=e.agents;return t.splice(t.indexOf(e.selected_agent),1),{agents:t,selected_agent:{}}})));case 8:case"end":return e.stop()}var t}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeModal",value:function(){this.setState({showConfirm:!1,showAddAgent:!1,showDeleteAgent:!1,showEditAgent:!1})}},{key:"closeModalGetAgents",value:function(){this.setState({showConfirm:!1,showAddAgent:!1,showDeleteAgent:!1,showEditAgent:!1}),this.getAgents()}},{key:"showDeleteAgent",value:function(e,t){e.preventDefault(),this.setState({selected_agent:t,showDeleteAgent:!0,confirmMessage:"Are you sure you want to delete agent "+t.firstname+"'s profile? This cant be undone."})}},{key:"showAddAgent",value:function(){this.setState({showAddAgent:!0})}},{key:"showEditAgent",value:function(e,t){e.preventDefault(),this.setState({showEditAgent:!0,selected_agent:t})}},{key:"onDepartmentChanged",value:function(e){var t=e.target.value;this.setState({selected_department:t}),"All"===t?this.getAgents():this.getAgentsDepartment(t)}},{key:"componentDidMount",value:function(){this.getAgents(),this.getDepartments()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"laser-parent-div"},s.a.createElement("div",{className:"laser-top-panel"},s.a.createElement("h4",{className:"laser-inline"},"Laser Emergency Admin - Agents"),s.a.createElement("div",{className:"laser-controls"},s.a.createElement(m.b,{style:It,to:"/",className:"nav-link white-text link laser-inline laser-150-width"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"View Map")),s.a.createElement("select",{style:It,className:"form-control laser-inline laser-150-width",id:"filter",name:"filter",value:this.state.selected_department,onChange:this.onDepartmentChanged},this.state.departments.map((function(e){return s.a.createElement("option",null,e)}))),s.a.createElement("button",{onClick:this.showAddAgent,style:It,className:"laser-inline laser-100-width laserbtn laser-white_border-blue-bg"},"Add Agent"),s.a.createElement(m.b,{style:It,to:"/admins",className:"nav-link white-text link"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"Admins")),s.a.createElement(m.b,{style:It,to:"/departments",className:"nav-link white-text link"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"Departments")),s.a.createElement("button",{onClick:function(t){return e.props.logout(t)},className:"form-control laser-inline laser-100-width laser-grey-bg laserbtn pull-right"},"logout"))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"container"},this.state.agents.map((function(t){return s.a.createElement(jt,{agent:t,key:t._id,deleteClicked:e.showDeleteAgent,editClicked:e.showEditAgent})})))),s.a.createElement(ht,{isLoading:this.state.isLoading}),this.state.showAddAgent?s.a.createElement(Rt,{closeModal:this.closeModal,departments:this.state.departments,closeModalGetAgents:this.closeModalGetAgents}):"",this.state.showDeleteAgent?s.a.createElement(at,{yesClicked:this.deleteAgent,noClicked:this.closeModal,message:this.state.confirmMessage}):"")}}]),n}(a.Component),Gt=new ae,Bt={marginLeft:"8px"};function qt(e){return s.a.createElement("div",{className:"col-md-6 col-sm-6"},s.a.createElement("div",{className:"laser-item shadow"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-7 col-sm-7"},s.a.createElement("h5",null,"Username"),s.a.createElement("h4",null,e.admin.username)),s.a.createElement("div",{className:"col-md-5 col-sm-5"},s.a.createElement("h5",null,"Phone Number"),s.a.createElement("h5",null,e.admin.phone_number),s.a.createElement("br",null),s.a.createElement("h5",null,"Priviledge"),s.a.createElement("h4",null,e.admin.priviledge," priviledge")),s.a.createElement("div",{className:"col-md-7 col-sm-7"},s.a.createElement("h5",null,"Full Name"),s.a.createElement("h4",null,e.admin.firstname," ",e.admin.lastname),s.a.createElement("br",null),s.a.createElement("h5",null,"Created"),s.a.createElement("h5",null,Gt.getDate(e.admin.created))),s.a.createElement("div",{className:"col-md-5 col-sm-5"},s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{onClick:function(t){return e.deleteClicked(t,e.admin)},className:"laserbtn laser-red-bg laser-inline"},"delete"),s.a.createElement("button",{style:Bt,onClick:function(t){return e.editClicked(t,e.admin)},className:"laserbtn laser-blue-bg laser-inline"},"edit")))))}xe.a.setAppElement("#main");var zt={marginRight:"8px"},Ut={marginLeft:"8px",marginRight:"16px"},Yt={marginRight:"8px"},Ht=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={firstname:"",lastname:"",username:"",phone_number:"",password:"",password_again:"",priviledge:"",error:"",isLoading:!1},a.submitClicked=a.submitClicked.bind(Object(c.a)(a)),a.onFieldChanged=a.onFieldChanged.bind(Object(c.a)(a)),a.showLoading=a.showLoading.bind(Object(c.a)(a)),a.hideLoading=a.hideLoading.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"submitClicked",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),this.setState({error:""}),!(this.state.firstname.length<=0||this.state.lastname.length<=0)){e.next=5;break}return this.setState({error:"Please enter a valid first and last name"}),e.abrupt("return");case 5:if(!(this.state.phone_number.length<11)){e.next=8;break}return this.setState({error:"Please enter a valid phone number"}),e.abrupt("return");case 8:if(!(this.state.priviledge.length<0)){e.next=11;break}return this.setState({error:"Please enter a valid department"}),e.abrupt("return");case 11:if(!(this.state.username.length<0)){e.next=14;break}return this.setState({error:"Please enter a valid Username"}),e.abrupt("return");case 14:if(!(this.state.password.length<8||this.state.password_again.length<8)){e.next=17;break}return this.setState({error:"Please enter a valid password with 8 characters or more"}),e.abrupt("return");case 17:if(this.state.password===this.state.password_again){e.next=20;break}return this.setState({error:"Passwords dont match"}),e.abrupt("return");case 20:return n={firstname:this.state.firstname,lastname:this.state.lastname,phone_number:this.state.phone_number,username:this.state.username,priviledge:this.state.priviledge,password:this.state.password,password_again:this.state.password_again},e.next=23,Et(n);case 23:if("error"!=(a=e.sent)){e.next=27;break}return this.setState({action:"message",action_message:"An error occurred creating agent, Please try again later"}),e.abrupt("return");case 27:a&&a.data?(this.hideLoading(),this.props.closeModalGetAgents()):this.setState({action:"close"});case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onFieldChanged",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,a=t.name;this.setState(Object(h.a)({},a,n))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(xe.a,{isOpen:!0,className:"AdminModal",overlayClassName:"Overlay",contentLabel:"Minimal Modal Example"},s.a.createElement("h4",{className:"text-center blue-text"},"Add Admin"),s.a.createElement("br",null),s.a.createElement("h5",{className:"laser-red-text"},this.state.error?this.state.error:""),s.a.createElement("br",null),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"User Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"username",type:"text",name:"username",onChange:this.onFieldChanged,value:this.state.username,className:"form-control bt-login-input",placeholder:"User Name"}))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"First Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"firstname",type:"text",name:"firstname",onChange:this.onFieldChanged,value:this.state.firstname,className:"form-control bt-login-input",placeholder:"First Name"})),s.a.createElement("div",{className:"col-md-6"},s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Last Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"lastname",type:"text",name:"lastname",onChange:this.onFieldChanged,value:this.state.lastname,className:"form-control bt-login-input",placeholder:"Last Name"}))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("br",null),s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Phone Number")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"phone_number",type:"phone",name:"phone_number",onChange:this.onFieldChanged,value:this.state.phone_number,className:"form-control bt-login-input",placeholder:"Phone Number"})),s.a.createElement("div",{className:"col-md-6"},s.a.createElement("br",null),s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Priviledge")),s.a.createElement("select",{style:Yt,className:"form-control",id:"department",name:"department",value:this.state.department,onChange:this.onFieldChanged},s.a.createElement("option",null,"full_control"),s.a.createElement("option",null,"view_control")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("br",null),s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Password")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"password",type:"password",name:"password",onChange:this.onFieldChanged,value:this.state.password,className:"form-control bt-login-input",placeholder:"Password"})),s.a.createElement("div",{className:"col-md-6"},s.a.createElement("br",null),s.a.createElement("label",{htmlFor:"category"},s.a.createElement("h5",null,"Password Again")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"password_again",type:"password",name:"password_again",onChange:this.onFieldChanged,value:this.state.password_again,className:"form-control bt-login-input",placeholder:"Password Again"}))),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-inline laser-blue-bg laserbtn",style:zt,onClick:function(t){return e.submitClicked(t)}},"create"),s.a.createElement("button",{className:"laser-inline grey-bg laserbtn laser-black-text",style:Ut,onClick:this.props.closeModal},"cancel")),s.a.createElement(ht,{isLoading:this.state.isLoading}))}}]),n}(a.Component);xe.a.setAppElement("#main");var Wt={marginRight:"8px"},Jt={marginLeft:"8px",marginRight:"16px"},Vt={marginRight:"8px"},Kt=(a.Component,{marginLeft:"8px",marginRight:"8px"}),Zt=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={admins:[],selected_admin:{},showConfirm:!1,showAddAdmin:!1,showDeleteAdmin:!1,showEditAdmin:!1,confirmMessage:"",isLoading:!1},a.getAdmins=a.getAdmins.bind(Object(c.a)(a)),a.deleteAdmin=a.deleteAdmin.bind(Object(c.a)(a)),a.closeModal=a.closeModal.bind(Object(c.a)(a)),a.closeModalGetAdmins=a.closeModalGetAdmins.bind(Object(c.a)(a)),a.showDeleteAdmin=a.showDeleteAdmin.bind(Object(c.a)(a)),a.showAddAdmin=a.showAddAdmin.bind(Object(c.a)(a)),a.showEditAdmin=a.showEditAdmin.bind(Object(c.a)(a)),a.showLoading=a.showLoading.bind(Object(c.a)(a)),a.hideLoading=a.hideLoading.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"getAdmins",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,pt("/get_admins",{count:void 0}).then((function(e){return e})).catch((function(e){return"error"}));case 3:if(t=e.sent,this.hideLoading(),"error"!==t){e.next=7;break}return e.abrupt("return");case 7:t&&t.data&&t.data.length>0&&this.setState({admins:t.data});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteAdmin",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,t=this.state.selected_admin._id,pt("/delete_admin",{id:t}).then((function(e){return e})).catch((function(e){return"error"}));case 3:if(n=e.sent,this.hideLoading(),"error"!==n){e.next=7;break}return e.abrupt("return");case 7:n&&n.data&&(this.closeModal(),this.setState((function(e){var t=e.admins;return t.splice(t.indexOf(e.selected_admin),1),{admins:t,selected_admin:{}}})));case 8:case"end":return e.stop()}var t}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeModal",value:function(){this.setState({showConfirm:!1,showAddAdmin:!1,showDeleteAdmin:!1,showEditAdmin:!1})}},{key:"closeModalGetAdmins",value:function(){this.setState({showConfirm:!1,showAddAdmin:!1,showDeleteAdmin:!1,showEditAdmin:!1}),this.getAdmins()}},{key:"showDeleteAdmin",value:function(e,t){e.preventDefault(),this.setState({selected_admin:t,showDeleteAdmin:!0,confirmMessage:"Are you sure you want to delete admin "+t.firstname+"'s profile? This cant be undone."})}},{key:"showAddAdmin",value:function(){this.setState({showAddAdmin:!0})}},{key:"showEditAdmin",value:function(e,t){e.preventDefault(),this.setState({showEditAdmin:!0,selected_admin:t})}},{key:"componentDidMount",value:function(){this.getAdmins()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"laser-parent-div"},s.a.createElement("div",{className:"laser-top-panel"},s.a.createElement("h4",{className:"laser-inline"},"Laser Emergency Admins"),s.a.createElement("div",{className:"laser-controls"},s.a.createElement(m.b,{style:Kt,to:"/",className:"nav-link white-text link laser-inline laser-150-width"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"View Map")),s.a.createElement("button",{onClick:this.showAddAdmin,style:Kt,className:"laser-inline laser-150-width laserbtn laser-white_border-blue-bg"},"Add Admin"),s.a.createElement(m.b,{style:Kt,to:"/agents",className:"nav-link white-text link"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"Agents")),s.a.createElement(m.b,{style:Kt,to:"/departments",className:"nav-link white-text link"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"Departments")),s.a.createElement("button",{onClick:function(t){return e.props.logout(t)},className:"form-control laser-inline laser-100-width laser-grey-bg laserbtn pull-right"},"logout"))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"container"},this.state.admins.map((function(t){return s.a.createElement(qt,{admin:t,key:t._id,deleteClicked:e.showDeleteAdmin,editClicked:e.showEditAdmin})})))),s.a.createElement(ht,{isLoading:this.state.isLoading}),this.state.showAddAdmin?s.a.createElement(Ht,{closeModal:this.closeModal,departments:this.state.departments,closeModalGetAdmins:this.closeModalGetAdmins}):"",this.state.showDeleteAdmin?s.a.createElement(at,{yesClicked:this.deleteAdmin,noClicked:this.closeModal,message:this.state.confirmMessage}):"")}}]),n}(a.Component),$t=new ae,Qt={marginLeft:"16px"};function Xt(e){return s.a.createElement("div",{className:"col-md-4 col-sm-4"},s.a.createElement("div",{className:"laser-item shadow"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-7 col-sm-7"},s.a.createElement("h4",{className:"laser-black-text"},e.department.name)),s.a.createElement("div",{className:"col-md-5 col-sm-5"},s.a.createElement("h5",null,$t.getDate(e.department.created)))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-offset-6 col-md-6 col-sm-offset-6 col-sm-6"},s.a.createElement("button",{onClick:function(t){return e.deleteClicked(t,e.department)},className:"laserbtn laser-red-bg laser-inline"},"delete"),s.a.createElement("button",{style:Qt,onClick:function(t){return e.editClicked(t,e.department)},className:"laserbtn laser-blue-bg laser-inline"},"edit")))))}xe.a.setAppElement("#main");var en={marginLeft:"16px",marginRight:"8px"},tn={marginLeft:"8px",marginRight:"16px"},nn=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={name:"",action:"loading",action_message:"",isLoading:!1},a.showLoading=a.showLoading.bind(Object(c.a)(a)),a.hideLoading=a.hideLoading.bind(Object(c.a)(a)),a.onFieldChanged=a.onFieldChanged.bind(Object(c.a)(a)),a.saveDepartment=a.saveDepartment.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"saveDepartment",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.state.name.length>0)){e.next=8;break}return e.next=3,n=this.state.name,pt("/create_department",{name:n}).then((function(e){return e})).catch((function(e){return"error"}));case 3:if("error"!=(t=e.sent)){e.next=7;break}return this.setState({action:"message",action_message:"An error occurred creating department, Please try again later"}),e.abrupt("return");case 7:t&&t.data?(this.props.closeModal(),this.props.getDepartments()):this.setState({action:"close"});case 8:case"end":return e.stop()}var n}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onFieldChanged",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,a=t.name;this.setState(Object(h.a)({},a,n))}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(xe.a,{isOpen:!0,className:"ConfirmModal",overlayClassName:"Overlay",contentLabel:"Minimal Modal Example"},s.a.createElement("h4",{className:"text-center blue-text"},"Add Department"),s.a.createElement("label",{className:"laser-white-text",htmlFor:"category"},s.a.createElement("h5",null,"Department Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"name",type:"text",name:"name",onChange:this.onFieldChanged,value:this.state.name,className:"form-control bt-login-input",placeholder:"Department Name"}),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-inline laser-blue-bg laserbtn",style:en,onClick:this.saveDepartment},"save"),s.a.createElement("button",{className:"laser-inline grey-bg laserbtn",style:tn,onClick:this.props.closeModal},"cancel")),s.a.createElement(ht,{isLoading:this.state.isLoading}))}}]),n}(a.Component),an={marginLeft:"8px",marginRight:"8px"},sn=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={departments:[],selected_department:{},showConfirm:!1,showAddDepartment:!1,showDeleteDepartment:!1,showEditDepartment:!1,confirmMessage:"",isLoading:!1},a.getDepartments=a.getDepartments.bind(Object(c.a)(a)),a.deleteDepartment=a.deleteDepartment.bind(Object(c.a)(a)),a.closeModal=a.closeModal.bind(Object(c.a)(a)),a.showDeleteDepartment=a.showDeleteDepartment.bind(Object(c.a)(a)),a.showAddDepartment=a.showAddDepartment.bind(Object(c.a)(a)),a.showEditDepartment=a.showEditDepartment.bind(Object(c.a)(a)),a.showLoading=a.showLoading.bind(Object(c.a)(a)),a.hideLoading=a.hideLoading.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"getDepartments",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,vt();case 3:if(t=e.sent,this.hideLoading(),"error"!==t){e.next=7;break}return e.abrupt("return");case 7:t&&t.data&&t.data.length>0&&this.setState({departments:t.data});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteDepartment",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showLoading(),e.next=3,n=this.state.selected_department._id,pt("/delete_department",{id:n}).then((function(e){return e})).catch((function(e){return"error"}));case 3:if(t=e.sent,this.hideLoading(),"error"!==t){e.next=7;break}return e.abrupt("return");case 7:t&&t.data&&(this.closeModal(),this.setState((function(e){var t=e.departments;return t.splice(t.indexOf(e.selected_department),1),{departments:t,selected_department:{}}})));case 8:case"end":return e.stop()}var n}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"showDeleteDepartment",value:function(e,t){this.setState({selected_department:t,showDeleteDepartment:!0,confirmMessage:"Are you sure you want to delete the selected department?"}),e.preventDefault()}},{key:"showAddDepartment",value:function(){this.setState({showAddDepartment:!0})}},{key:"showEditDepartment",value:function(e,t){this.setState({showEditDepartment:!0,selected_department:t}),e.preventDefault()}},{key:"closeModal",value:function(){this.setState({showConfirm:!1,showAddDepartment:!1,showDeleteDepartment:!1,showEditDepartment:!1})}},{key:"componentDidMount",value:function(){this.getDepartments()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"laser-parent-div"},s.a.createElement("div",{className:"laser-top-panel"},s.a.createElement("h4",{className:"laser-inline"},"Laser Emergency Admin - Departments"),s.a.createElement("div",{className:"laser-controls"},s.a.createElement(m.b,{style:an,to:"/",className:"nav-link white-text link laser-inline laser-150-width"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"View Map")),s.a.createElement(m.b,{style:an,to:"/agents",className:"nav-link white-text link"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"Agents")),s.a.createElement(m.b,{style:an,to:"/admins",className:"nav-link white-text link"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"Admins")),s.a.createElement(m.b,{style:an,to:"/departments",className:"nav-link white-text link"},s.a.createElement("button",{className:"laserbtn laser-white_border-blue-bg"},"Departments")),s.a.createElement("button",{style:an,onClick:this.showAddDepartment,className:"laser-inline laser-150-width laserbtn laser-white_border-blue-bg"},"Add Department"),s.a.createElement("button",{onClick:function(t){return e.props.logout(t)},className:"form-control laser-inline laser-100-width laser-grey-bg laserbtn pull-right"},"logout"))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"container"},s.a.createElement("br",null),this.state.departments.map((function(t){return s.a.createElement(Xt,{key:t._id,department:t,deleteClicked:e.showDeleteDepartment,editClicked:e.showEditDepartment})})))),this.state.showAddDepartment?s.a.createElement(nn,{getDepartments:this.getDepartments,closeModal:this.closeModal}):"",this.state.showDeleteDepartment?s.a.createElement(at,{yesClicked:this.deleteDepartment,noClicked:this.closeModal,message:this.state.confirmMessage}):"",s.a.createElement(ht,{isLoading:this.state.isLoading}))}}]),n}(a.Component),rn=new ce,ln={marginBottom:"0px",marginTop:"0px"},on=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={username:"",password:"",error:"",isLoading:!1},a.submitClicked=a.submitClicked.bind(Object(c.a)(a)),a.onFieldChanged=a.onFieldChanged.bind(Object(c.a)(a)),a.showLoading=a.showLoading.bind(Object(c.a)(a)),a.hideLoading=a.hideLoading.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"showLoading",value:function(){this.setState({isLoading:!0})}},{key:"hideLoading",value:function(){this.setState({isLoading:!1})}},{key:"submitClicked",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),this.setState({error:""}),!(this.state.username.length<=0||this.state.password.length<=0)){e.next=5;break}return this.setState({error:"Please make sure all fields are completed"}),e.abrupt("return");case 5:return this.showLoading(),e.next=8,rn.login(this.state.username,this.state.password);case 8:if(a=e.sent,this.hideLoading(),"error"!==a){e.next=13;break}return this.setState({error:"An error occurred login you in. Please try again later."}),e.abrupt("return");case 13:a&&a.data&&(this.props.login(),this.props.history.push("/"));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onFieldChanged",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,a=t.name;this.setState(Object(h.a)({},a,n))}},{key:"render",value:function(){return s.a.createElement("div",{className:"laser-login-bg"},s.a.createElement("div",{className:"laser-login-div laser-shadow"},s.a.createElement("h2",{className:"bt-blue-text laser-white-text",style:ln},"Admin"),s.a.createElement("h2",{className:"bt-blue-text laser-white-text",style:ln},"Login"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("h5",{className:"laser-red-text"},this.state.error?this.state.error:""),s.a.createElement("br",null),s.a.createElement("label",{className:"laser-white-text",htmlFor:"category"},s.a.createElement("h5",null,"User Name")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"username",type:"text",name:"username",onChange:this.onFieldChanged,value:this.state.username,className:"form-control bt-login-input",placeholder:"User Name"}),s.a.createElement("br",null),s.a.createElement("label",{className:"laser-white-text",htmlFor:"category"},s.a.createElement("h5",null,"Password")),s.a.createElement("input",{required:!0,autoComplete:"off",id:"password",type:"password",name:"password",onChange:this.onFieldChanged,value:this.state.password,className:"form-control bt-login-input",placeholder:"Password"}),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"laser-blue-bg laserbtn",onClick:this.submitClicked},"CONTINUE")),s.a.createElement(ht,{isLoading:this.state.isLoading}))}}]),n}(a.Component),cn=new ce,dn=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).logout=function(){cn.logout(),a.setState({isLogin:!0})},a.login=function(){a.setState({isLogin:!1})},a.state={isLogin:!1},a.logout=a.logout.bind(Object(c.a)(a)),a.login=a.login.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(m.a,null,s.a.createElement(g.b,{path:"/",exact:!0,render:function(t){return!0===cn.loggedIn()?s.a.createElement(Lt,Object.assign({},t,{logout:e.logout})):s.a.createElement(g.a,{to:"/login",login:e.login})}}),s.a.createElement(g.b,{path:"/agents",exact:!0,render:function(t){return!0===cn.loggedIn()?"full_control"===cn.getPriviledge()?s.a.createElement(Tt,Object.assign({},t,{logout:e.logout})):s.a.createElement(g.a,{to:"/",login:e.login}):s.a.createElement(g.a,{to:"/login",login:e.login})}}),s.a.createElement(g.b,{path:"/admins",exact:!0,render:function(t){return!0===cn.loggedIn()?"full_control"===cn.getPriviledge()?s.a.createElement(Zt,Object.assign({},t,{logout:e.logout})):s.a.createElement(g.a,{to:"/",login:e.login}):s.a.createElement(g.a,{to:"/login",login:e.login})}}),s.a.createElement(g.b,{path:"/departments",exact:!0,render:function(t){return!0===cn.loggedIn()?"full_control"===cn.getPriviledge()?s.a.createElement(sn,Object.assign({},t,{logout:e.logout})):s.a.createElement(g.a,{to:"/",login:e.login}):s.a.createElement(g.a,{to:"/login",login:e.login})}}),s.a.createElement(g.b,{path:"/login",exact:!0,render:function(t){return!1===cn.loggedIn()?s.a.createElement(on,Object.assign({},t,{login:e.login})):s.a.createElement(g.a,Object.assign({to:"/"},t,{logout:e.logout}))}}),1==this.state.isLogin?s.a.createElement(g.a,{to:"/login",login:this.login}):""))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(dn,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[135,1,2]]]);
//# sourceMappingURL=main.e24827e6.chunk.js.map